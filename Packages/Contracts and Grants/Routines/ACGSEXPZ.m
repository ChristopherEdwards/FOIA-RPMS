ACGSEXPZ ;IHS/OIRM/DSD/THL,AEF - EXPORT CONTROLLER - CONT'D; [ 03/27/2000   2:22 PM ]
 ;;2.0t1;CONTRACT INFORMATION SYSTEM;;FEB 16, 2000
 ;;EXPORT CONTROLLER - CONT'D
EN D ^XBKVAR
 S:'DUZ(2) DUZ(2)=$O(^VA(200,.5,2,0))
 Q:'$D(^ACGPARA(1,0))  S ACGPARA=^(0),ACG4=$P(ACGPARA,U,3)
 I ACG4<200 D DX^ACGSEXP Q
 S ACGX="rm /usr/spool/uucppublic/acg"_ACG4_".asc*",ACGX=$$JOBWAIT^%HOSTCMD(ACGX)
 S ACGX="rm /usr2/acg"_ACG4_".asc*",ACGX=$$JOBWAIT^%HOSTCMD(ACGX)
 I ACG4=236 D ^ACGSEXP Q
 D DX^ACGSEXP
 S:ACG4>200 ACGX="sendto dpssyg /usr/spool/uucppublic/acg"_ACG4_".asc",ACGX=$$JOBWAIT^%HOSTCMD(ACGX)
 S DR="3////1;4////"_DT,DIE="^ACGPARA(",DA=1
 D DIE^ACGSDIC
EXIT K ACGT1,ACGRDA,ACGSIGN,ACGY,ACGFY,%DEV,%FN,%X,%Y
 Q
EXPORT S AUDT=DT,AUGL="ACGEXP",AUGL="ACGS",AUIO=51,AUMED="F",AUTLE="CIS MONTHLY DATA EXPORT",(AUFN,%FN)=$S($P(ACGPARA,U,2)=1:"acg",1:"A:ACG")_ACG4_".asc"
 I ACG4=236 D HQ Q
 D ^XBGSAVE
 S DR="3////1;4////"_DT
 S DIE="^ACGPARA(",DA=1 D ^DIE K DIE,DA,DR
 Q
HQ S ACGT1=$P($H,",",2)
HFS1 S %ZIS("IOPAR")=%FN,IOP=$S(ACG4>200:"HOST FILE SERVER #4",1:51)
 D ^%ZIS
 K IOP
 I POP>0 S DR="3////2",DIE="^ACGPARA(",DA=1 D ^DIE K DIE,DA,DR Q
 U IO
 S (ACGCNT,ACGRDA)=0
 F  S ACGRDA=$O(^ACGS(ACGRDA)) Q:'ACGRDA  I +^ACGS(ACGRDA,"DT")'=14,+^("DT")'=16,$P(^ACGS($P(^(0),U,3),"IHS"),U,23)=1 D ^ACGSFLDS I $L(ACGY)=600 W ACGY
 D ^%ZISC
 S DR="3////1;4////"_DT,DIE="^ACGPARA(",DA=1
 D ^DIE
 K DIE,DA,DR
 Q
