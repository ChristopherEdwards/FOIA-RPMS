ICDDRG0 ;ALB/GRR/EG - DRG GROUPER PROCESSING BEGINS ; 14 MAR 89
 ;;8.0
 ;GROUPING PROCESS BEGINS
 ;
GROUP ;
 I $D(ICDSEX(1))&($D(ICDSEX(2))) S ICDRTC=4,ICDDRG=470 G KILL^ICDDRG
 I ICDMDC'=14,ICDMDC'=17,ICDMDC'=18,ICDMDC'=19,ICDMDC'=20,ICDMDC'=23,ICDMDC'=15,ICDORNI["O",ICDNOR=ICDONR,ICDNOR>0,'$D(ICDPDRG(377)),ICDORNI'["p" S ICDRG=$S($D(ICDORNI("O")):468,ICDORNI["y":476,ICDORNI["z":477,1:468) G END
 I ICDMDC=5,ICDOR'["O" S ICDRTC=$S(ICDEXP="":5,1:"") S:ICDRTC'="" ICDRG=470 D:ICDRTC="" MI G END
 I ICDMDC=18,ICDOR["O"!(ICDORNI["O") S ICDRG=415 G END
 I ICDMDC=19,ICDOCNT>0,ICDOR["O" S (ICDRG,HICDRG)=424 G CKDRG
 I ICDMDC=23,ICDOR["O"!(ICDORNI["O") S ICDRG=461 G END
 I ICDMDC=14 D ^ICDDRG14 I ICDRG]"" G END
 I ICDMDC=20 S ICDRTC=$S(ICDDMS="":7,1:"") I ICDDMS'=0 S ICDRG=$S(ICDDMS="":470,1:433) G END
 I ICDMDC=22 S ICDRTC=$S(ICDTRS="":6,1:"") S:ICDRTC'="" ICDRG=470 D:ICDRTC="" CKBURN G END
 I ICDMDC=15 S ICDRTC=$S(ICDEXP="":5,ICDTRS="":6,1:"") I ICDTRS'=0!(ICDEXP'=0) S ICDRG=$S(ICDRTC'="":470,1:385) G END
 I 'ICDNOR!('$D(ICDODRG)) S ICDRG=$O(ICDPDRG(0)) X "I ICDMDC=15,$D(ICDSDRG),$O(ICDSDRG(0))<ICDRG S ICDRG=$S($D(ICDPDRG(391)):391,$D(ICDPDRG(387)):387,1:$O(ICDSDRG(0)))" X:$D(^ICD(ICDRG,"MC")) ^("MC") G GETMOR:ICDRG="",END
 I AGE="",ICDMDC=3 S ICDRTC=3,ICDRG=470 G END
 D ^ICDDRG2:ICDMDC=2,^ICDDRG3:ICDMDC=3,^ICDDRG5:ICDMDC=5,^ICDDRG6:ICDMDC=6,^ICDDRG7:ICDMDC=7,^ICDDRG8:ICDMDC=8,^ICDDRG9:ICDMDC=9,^ICDDRG12:ICDMDC=12,^ICDDRG13:ICDMDC=13
CONT G:ICDMDC=15 GETMOR S (ICDRG,HICDRG)=$O(ICDODRG(0)) G:ICDRG'>0 ENTER X:$D(^ICD(ICDRG,"MC")) ^("MC") G:ICDRG'>0 LOOK8:ICDMDC=8,AGAIN G END
ENTER I 'ICDNOR,ICDORNR'=0,ICDMDC'=20,ICDMDC'=15 S ICDRG=468 G END
GETMOR S (ICDRG,HICDRG)=$O(ICDPDRG(0)) S:ICDRG'>0 (ICDRG,HICDRG)=469 ;I ICDMDC=15,'$D(ICDODRG),$D(ICDSDRG),$O(ICDSDRG(0))<ICDRG S (ICDRG,HICDRG)=$O(ICDSDRG(0))
CKDRG I $D(^ICD(ICDRG,"MC")) X ^("MC") I ICDRG="" K ICDPDRG(HICDRG) G GETMOR
END D:ICDP25=1!((ICDP25>1)&($D(ICDS25(1))))!($D(ICDS25(1)))!($D(ICDS25(2)))!($D(ICDS25(3))) CKHIV^ICDDRGX S ICDDRG=ICDRG
 D:ICDP24'=""!($D(ICDS24)) CKMST^ICDDRGX S ICDDRG=ICDRG
 D:$D(ICDP15(1)) NEO S ICDDRG=ICDRG
 I $D(ICDNMDC(1)) I ICDNMDC(1)="" D CKNMDC^ICDDRGX S ICDDRG=ICDRG K ICDNMDC
 S:ICDRTC="" ICDRTC=0
 G KILL^ICDDRG
MI I ICDPD["AI"!(ICDSD["AI") S ICDRG=$S($S($D(ICDEXP):ICDEXP,1:0):123,ICDPD["V"!(ICDSD["V"):121,1:122) Q
 I $D(ICDOP(" 37.26"))&($D(ICDOP(" 39.61"))) S ICDRG=108 Q
 I $D(ICDOP(" 37.26")) S ICDRG=112 Q
 I ICDOR["H" S ICDRG=$S(ICDPD["X"!(ICDSD["X"):124,1:125) Q
 K ICDPDRG(124)
 S ICDRG=$O(ICDPDRG(0)) X:$D(^ICD(ICDRG,"MC")) ^("MC") Q
CKBURN I ICDPD["*"!(ICDSD["*") S ICDRG=$S(ICDTRS:456,ICDOR["O":472,1:457)
 E  S ICDRG=$S(ICDTRS:456,$D(ICDODRG(458)):458,ICDOR["O":459,1:460)
 Q
NEO ;possible neonate
 S:($D(ICDPDRG(387))!$D(ICDPDRG(388))!$D(ICDSDRG(387))!$D(ICDSDRG(388))) ICDRG=$S(ICDPD["Hp"&(ICDSD["J"):387,ICDPD["J"&(ICDSD["Hp"):387,ICDPD["Hp"&(ICDSD'["J"):388,ICDPD'["J"&(ICDSD["Hp"):388,1:ICDRG)
 S:($D(ICDPDRG(390))!$D(ICDPDRG(389))!$D(ICDSDRG(389))!$D(ICDSDRG(390))) ICDRG=$S(ICDPD["R"&(ICDSD["J"):389,ICDPD["J"&(ICDSD["R"):389,ICDSD["R":389,ICDSD["J"&(ICDSD'["E"!(ICDSD'["p")):389,1:ICDRG)
 S:($D(ICDPDRG(390))!$D(ICDPDRG(389))!$D(ICDSDRG(389))!$D(ICDSDRG(390))) ICDRG=$S(ICDPD["R"&(ICDSD'["J"):390,ICDPD'["J"&(ICDSD["R"):390,1:ICDRG)
 S:(ICDRG>386)&(ICDRG<391) ICDRTC=0
 Q
AGAIN G:'$D(ICDODRG) ENTER
 K ICDODRG(HICDRG) I $O(ICDODRG(HICDRG))'>0 K ICDODRG G GROUP
 S ICDRG=$O(ICDODRG(HICDRG)) G GROUP
 ;
 ;
DRG193 ;193-204 series
 S ICDRG=$S(ICDOR["T"&(ICDOR["E"):$S(ICDCC:195,1:196),ICDOR["3"!(ICDOR["E"):$S(ICDCC:193,1:194),ICDOR["T"&((ICDOR'["E")):$S(ICDCC:197,1:198),ICDPD["M"&(ICDOR["h"):199,ICDPD'["M"&(ICDOR["h"):200,ICDPD["M"&(ICDOR'["h"):203,1:204)
 Q
LOOK8 G:'$D(ICDJ) GETMOR S ICDJ=$O(ICDJ(0)) G:ICDJ'>0 GETMOR K ICDJ(ICDJ),ICDODRG D END^ICDDRG8 G GETMOR:'$D(ICDODRG),CONT
 ;
