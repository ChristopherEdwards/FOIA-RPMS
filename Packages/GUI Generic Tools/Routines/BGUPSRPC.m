BGUPSRPC ; IHS/OIT/MJL - GENERAL BGU UTILITY ;
 ;;1.5;BGU;;MAY 26, 2005
EN(BGUARRAY,BGUPSRPC,BGUP1,BGUP2,BGUP3,BGUP4,BGUP5,BGUP6,BGUP7,BGUP8,BGUP9,BGUP10,BGUP11) ;PEP FROM REMOTE PROCEDURE BGU PSRPC
ENT ;
 ;K X,Y,BGUDATA N DIQUIET
 ;S BGUSTR=^BGUPSRPC(BGUPSRPC,"ASTR")
 S BGUPSIEN=$O(^BGUPSRPC("B",BGUPSRPC,"")) Q:BGUPSRPC=""  S BGUIEN=$P(^BGUPSRPC(BGUPSIEN,0),U,2),BGUREF=^XWB(8994,BGUIEN,0)
 S BGUTRTN=$P(BGUREF,"^",2,3),BGUTYPE=$P(BGUREF,U,4),BGURTN1=BGUTRTN,BGUTRTN=BGUTRTN_"(.BGUDATA,"_$$GETSTR()_")"
 ;S BGUSTR=BGURTN1_"(.BGUDATA,"_BGUSTR_")"
 D @BGUTRTN
 ; Same line of code used in ^BGUTCPH :
 ;D:$S($P(BGUMSG,"TRACE=",2)'="":1,$D(BGUTRACE):1,$P(^BGUSP(1,0),"^",2)="Y":1,1:$D(^BGUSP(1,1,"B",$J))) ^BGUTRACE
 ;D KILL
 Q
 ;
GETSTR() ;
 S BGUEND=0
 S BGUN=0 F  S BGUN=$O(^BGUPSRPC(BGUPSIEN,1,BGUN)) Q:'BGUN  S BGUX=^BGUPSRPC(BGUPSIEN,1,BGUN,0),BGUVAL=$P(BGUX,U,2) I BGUVAL'="" S BGUPRM=$P(BGUX,U,1),BGUPV(BGUPRM)=BGUVAL S:BGUPRM>BGUEND BGUEND=BGUPRM
 F BGUEND1=1:1 S BGUP="BGUP"_BGUEND1 Q:'$D(@BGUP)  S BGUP=@BGUP S:BGUP'="" BGUPV(BGUEND1)=BGUP
 S:BGUEND1>BGUEND BGUEND=BGUEND1
 S BGUX="" F BGUPRM=1:1:BGUEND S:BGUPRM>1 BGUX=BGUX_"," S BGUX=BGUX_""""_$G(BGUPV(BGUPRM))_""""
 K BGUP,BGUPRM,BGUPV,BGUVAL
 Q BGUX
