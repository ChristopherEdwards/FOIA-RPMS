HLOPOST ;IRMFO-ALB/CJM -Post-Install routine for HLO;03/24/2004  14:43
 ;;1.6;HEALTH LEVEL SEVEN;**126**;Oct 13, 1995
 ;
 N SYSTEM,DATA,VASITE,OLDSITE
 D IDXLINKS
 D SYSPARMS^HLOSITE(.SYSTEM)
 S VASITE=$$SITE^VASITE
 S OLDSITE=$G(^HLCS(869.3,1,0))
 S DATA(.01)=SYSTEM("DOMAIN")
 I DATA(.01)="" D
 .I $P(OLDSITE,"^",2) S DATA(.01)="HL7."_$P($G(^DIC(4.2,$P(OLDSITE,"^",2),0)),"^")
 I DATA(.01)="" D
 .N INST,DOMAIN
 .S INST=$P(VASITE,"^")
 .Q:'INST
 .S DOMAIN=$P($G(^DIC(4,INST,6)),"^")
 .I DOMAIN S DOMAIN=$P($G(^DIC(4.2,DOMAIN,0)),"^") I DOMAIN'="" S DATA(.01)="HL7."_DOMAIN
 I DATA(.01)="" D BMES^XPDUTL("Post-Install failed, system missing INSTITUTION or DOMAIN file entry") Q
 S DATA(.02)=SYSTEM("STATION")
 I DATA(.02)="",$P(OLDSITE,"^",4) S DATA(.02)=$P($G(^DIC(4,$P(OLDSITE,"^",4),99)),"^")
 I DATA(.02)="" S DATA(.02)=$P(VASITE,"^",3)
 S DATA(.03)=$P(OLDSITE,"^",3)
 S DATA(.04)=SYSTEM("MAXSTRING")
 S DATA(.05)=SYSTEM("HL7 BUFFER")
 S DATA(.06)=SYSTEM("USER BUFFER")
 S DATA(.07)=SYSTEM("NORMAL PURGE")
 S DATA(.08)=SYSTEM("ERROR PURGE")
 I $D(^HLD(779.1,1,0)) D
 .N ERROR
 .I '$$UPD^HLOASUB1(779.1,1,.DATA,.ERROR) D BMES^XPDUTL("Post-Install failed -"_$G(ERROR))
 E  D
 .N ERROR
 .I '$$ADD^HLOASUB1(779.1,,.DATA,.ERROR,1) D BMES^XPDUTL("Post-Install failed -"_$G(ERROR))
 Q
IDXLINKS ;
 ;set the "AC" and "AD" indicies on the HL Logical Link file
 N DIK
 S DIK="^HLCS(870,"
 S DIK(1)=".01^AC^AD^AD1^AD2"
 D ENALL^DIK
 Q
