BCSVEC ;IHS/MSC/BWF - CSV Package Update Utility ;16-Apr-2010 09:58;JSH
 ;;1.0;BCSV;;Apr 23, 2010;Build 44
 ;=================================================================
 ;
 ;
PATUPD ;
 N DLM,DDLM,QUIT,I,TEXT,DATA,PKGNM,VERSION,PATCH,PKGIEN,TAG,VSB,XREFREV
 S (XPDDIQ("XPZ1"),XPDDIQ("XPZ2"))=0  ; Suppress the Disable options and Move routine prompts
 S XPDABORT=0
 I '$D(^XPD(9.6,"B","IHS CSV DD MOVE 1.0")) S XPDABORT=1
 I XPDABORT D BMES^XPDUTL("IHS CSV DD MOVE 1.0 build must be installed to continue!") Q
 I '$D(^XCSV("MMDONE")) S XPDABORT=1
 I XPDABORT D BMES^XPDUTL("Manual mapping must be marked as 'complete' prior to installing this patch.") Q
 I $D(^XPD(9.6,"B","IHS CSV VA UPDATES 1.0")) S XPDABORT=1
 I XPDABORT D  Q
 .D BMES^XPDUTL("IHS CSV VA UPDATES has been installed before and may not be installed again!") Q
 .;D:$D(^XCSV("POSTKID")) FIX^BCSVP1
 S DDLM=";;",DLM="|",QUIT=0
 F TAG="LEX","ICD","ICPT" D
 .S QUIT=0
 .F I=1:1  D  Q:QUIT
 ..S TEXT=$T(@TAG+I) I TEXT="Q" S QUIT=1 Q
 ..S DATA=$P(TEXT,DDLM,2) I DATA="" S QUIT=1 Q
 ..S PKGNM=$P(DATA,DLM),VERSION=$P(DATA,DLM,2),PATCH=$P(DATA,DLM,3)
 ..I '$D(^DIC(9.4,"B",PKGNM)) Q
 ..S PKGIEN=$O(^DIC(9.4,"B",PKGNM,0)) Q:PKGIEN=""
 ..I TAG="ICD" D
 ...I $$GET1^DIQ(9.4,PKGIEN,13)=18.0 Q
 ...S FDA(9.4,PKGIEN_",",13)=18.0 D FILE^DIE(,"FDA")
 ..I '$D(^DIC(9.4,PKGIEN,22,"B",VERSION)) D
 ...K FDA
 ...S FDA(9.49,"+1,"_PKGIEN_",",.01)=VERSION
 ...D UPDATE^DIE(,"FDA")
 ...S FDA(9.49,"+1,"_PKGIEN_",",1)=$G(DT)
 ...S FDA(9.49,"+1,"_PKGIEN_",",2)=$G(DT)
 ...S FDA(9.49,"+1,"_PKGIEN_",",3)=$G(DUZ)
 ...D FILE^DIE(,"FDA")
 ..Q:PATCH=""
 ..S VSB=$O(^DIC(9.4,PKGIEN,22,"B",VERSION,0))
 ..Q:'VSB
 ..K FDA
 ..; Do not update if the patch is already in the patch history
 ..I $D(^DIC(9.4,PKGIEN,22,VSB,"PAH","B",PATCH)) Q
 ..S FDA(9.4901,"+1,"_VSB_","_PKGIEN_",",.01)=$G(PATCH)
 ..S FDA(9.4901,"+1,"_VSB_","_PKGIEN_",",.02)=DT
 ..S FDA(9.4901,"+1,"_VSB_","_PKGIEN_",",.03)=DUZ
 ..D UPDATE^DIE(,"FDA")
 Q
 ;;;;FORMAT - Package name|Version|Patch|Sequence
LEX ;
 ;;LEXICON UTILITY|2.0|1
 ;;LEXICON UTILITY|2.0|2
 ;;LEXICON UTILITY|2.0|3
 ;;LEXICON UTILITY|2.0|4
 ;;LEXICON UTILITY|2.0|5
 ;;LEXICON UTILITY|2.0|7 SEQ #6
 ;;LEXICON UTILITY|2.0|6 SEQ #7
 ;;LEXICON UTILITY|2.0|8 SEQ #8
 ;;LEXICON UTILITY|2.0|9 SEQ #9
 ;;LEXICON UTILITY|2.0|10 SEQ #10
 ;;LEXICON UTILITY|2.0|11 SEQ #11
 ;;LEXICON UTILITY|2.0|12 SEQ #12
 ;;LEXICON UTILITY|2.0|13 SEQ #13
 ;;LEXICON UTILITY|2.0|14 SEQ #14
 ;;LEXICON UTILITY|2.0|15 SEQ #15
 ;;LEXICON UTILITY|2.0|16 SEQ #16
 ;;LEXICON UTILITY|2.0|17 SEQ #17
 ;;LEXICON UTILITY|2.0|18 SEQ #18
 ;;LEXICON UTILITY|2.0|19 SEQ #19
 ;;LEXICON UTILITY|2.0|21 SEQ #20
 ;;LEXICON UTILITY|2.0|22 SEQ #21
 ;;LEXICON UTILITY|2.0|23 SEQ #22
 ;;LEXICON UTILITY|2.0|24 SEQ #23
 ;;LEXICON UTILITY|2.0|25 SEQ #24
 ;;LEXICON UTILITY|2.0|26 SEQ #25
 ;;LEXICON UTILITY|2.0|27 SEQ #26
 ;;LEXICON UTILITY|2.0|28 SEQ #27
 ;;LEXICON UTILITY|2.0|29 SEQ #28
 ;;LEXICON UTILITY|2.0|30 SEQ #29
 ;;LEXICON UTILITY|2.0|31 SEQ #30
 ;;LEXICON UTILITY|2.0|33 SEQ #31
 ;;LEXICON UTILITY|2.0|34 SEQ #32
 ;;LEXICON UTILITY|2.0|35 SEQ #33
 ;;LEXICON UTILITY|2.0|32 SEQ #34
 ;;LEXICON UTILITY|2.0|36 SEQ #35
 ;;LEXICON UTILITY|2.0|37 SEQ #36
 ;;LEXICON UTILITY|2.0|39 SEQ #37
 ;;LEXICON UTILITY|2.0|38 SEQ #38
 ;;LEXICON UTILITY|2.0|40 SEQ #39
 ;;LEXICON UTILITY|2.0|42 SEQ #41
 ;;LEXICON UTILITY|2.0|36 SEQ #35
 ;;LEXICON UTILITY|2.0|43
 ;;LEXICON UTILITY|2.0|45 SEQ #43
 ;;LEXICON UTILITY|2.0|46
 ;;LEXICON UTILITY|2.0|47
 ;;LEXICON UTILITY|2.0|48
 ;;LEXICON UTILITY|2.0|49
 ;;LEXICON UTILITY|2.0|50 SEQ #48
 ;;LEXICON UTILITY|2.0|52
 ;;LEXICON UTILITY|2.0|53
 ;;LEXICON UTILITY|2.0|54
 ;;
 Q
ICD ;
 ;;DRG GROUPER|9.0||
 ;;DRG GROUPER|10.0||
 ;;DRG GROUPER|11.0||
 ;;DRG GROUPER|12.0||
 ;;DRG GROUPER|13.0||
 ;;DRG GROUPER|14.0||
 ;;DRG GROUPER|15.0||
 ;;DRG GROUPER|16.0||
 ;;DRG GROUPER|17.0||
 ;;DRG GROUPER|18.0|1 SEQ #1
 ;;DRG GROUPER|18.0|2 SEQ #2
 ;;DRG GROUPER|18.0|3 SEQ #3
 ;;DRG GROUPER|18.0|4 SEQ #4
 ;;DRG GROUPER|18.0|5 SEQ #5
 ;;DRG GROUPER|18.0|6 SEQ #6
 ;;DRG GROUPER|18.0|7 SEQ #7
 ;;DRG GROUPER|18.0|8 SEQ #9
 ;;DRG GROUPER|18.0|10 SEQ #10
 ;;DRG GROUPER|18.0|11 SEQ #11
 ;;DRG GROUPER|18.0|12 SEQ #12
 ;;DRG GROUPER|18.0|13 SEQ #13
 ;;DRG GROUPER|18.0|14 SEQ #14
 ;;DRG GROUPER|18.0|16 SEQ #15
 ;;DRG GROUPER|18.0|15
 ;;DRG GROUPER|18.0|17 SEQ #17
 ;;DRG GROUPER|18.0|20 SEQ #19
 ;;DRG GROUPER|18.0|22 SEQ #21
 ;;DRG GROUPER|18.0|24 SEQ #24
 ;;DRG GROUPER|18.0|26 SEQ #25
 ;;DRG GROUPER|18.0|28
 ;;DRG GROUPER|18.0|27 SEQ #27
 ;;DRG GROUPER|18.0|30 SEQ #28
 ;;DRG GROUPER|18.0|29
 ;;DRG GROUPER|18.0|31
 ;;DRG GROUPER|18.0|32
 ;;
 Q
ICPT ;
 ;;CPT/HCPCS CODES|6.0|1 SEQ #1
 ;;CPT/HCPCS CODES|6.0|2 SEQ #2
 ;;CPT/HCPCS CODES|6.0|3 SEQ #3
 ;;CPT/HCPCS CODES|6.0|4 SEQ #4
 ;;CPT/HCPCS CODES|6.0|5 SEQ #5
 ;;CPT/HCPCS CODES|6.0|6 SEQ #6
 ;;CPT/HCPCS CODES|6.0|7 SEQ #7
 ;;CPT/HCPCS CODES|6.0|8 SEQ #8
 ;;CPT/HCPCS CODES|6.0|9 SEQ #9
 ;;CPT/HCPCS CODES|6.0|10 SEQ #10
 ;;CPT/HCPCS CODES|6.0|11 SEQ #11
 ;;CPT/HCPCS CODES|6.0|12 SEQ #12
 ;;CPT/HCPCS CODES|6.0|13 SEQ #13
 ;;CPT/HCPCS CODES|6.0|14 SEQ #14
 ;;CPT/HCPCS CODES|6.0|15 SEQ #15
 ;;CPT/HCPCS CODES|6.0|16 SEQ #16
 ;;CPT/HCPCS CODES|6.0|17 SEQ #17
 ;;CPT/HCPCS CODES|6.0|18 SEQ #18
 ;;CPT/HCPCS CODES|6.0|19 SEQ #19
 ;;CPT/HCPCS CODES|6.0|20 SEQ #20
 ;;CPT/HCPCS CODES|6.0|22 SEQ #23
 ;;CPT/HCPCS CODES|6.0|23 SEQ #22
 ;;CPT/HCPCS CODES|6.0|30
 ;;CPT/HCPCS CODES|6.0|34
 ;;CPT/HCPCS CODES|6.0|37
 ;;
 Q
AUPN ;
 ;;IHS DICTIONARIES (PATIENT)|99.1|20 SEQ #20
 Q
