BGP1D713 ; IHS/CMI/LAB - measure 31 ;
 ;;11.1;IHS CLINICAL REPORTING SYSTEM;;JUN 27, 2011;Build 33
 ;
PREGSCRN ;EP
 S BGPTOB=$$TOBHF^BGP1D712(DFN,BGP20M,BGPEDATE)
 S BGPSDX=$$DX^BGP1D7(DFN,BGP20M,BGPEDATE)
 S BGPXPBD=$$PED^BGP1D7(DFN,BGP20M,BGPEDATE)
 S BGP1320=$$DENT^BGP1D7(DFN,BGP20M,BGPEDATE)
 S BGPSCPT=$$CPTSM^BGP1D7(DFN,BGP20M,BGPEDATE)
 S BGPN6=$S(BGPTOB]"":1,1:0)
 I BGPSDX]"" S BGPN6=1
 I BGPXPBD]"" S BGPN6=1
 I BGP1320]"" S BGPN6=1
 I BGPSCPT]"" S BGPN6=1
 S (BGPVALUE,BGPVAL)=""
 S F=BGPTOB
 S %=""
 I BGPSDX]"",$P(BGPSDX,U,1)="305.13" S %=1
 I BGPSDX]"",$P(BGPSDX,U,1)="V15.82" S %=1
 ;BGPN7 - USER
 D
 .I $P(F,U,1)["CURRENT"!($P(F,U,1)["CESSATION") S BGPN7=1,BGPVAL=$P(BGPTOB,U,2)_" SCREEN (20 MONTHS), "_$P(BGPTOB,U,2)_" USER" Q
 .I $P(F,U,4)["CURRENT"!($P(F,U,4)["CESSATION") S BGPN7=1,BGPVAL=$P(BGPTOB,U,2)_" SCREEN (20 MONTHS), "_$P(BGPTOB,U,2)_" USER" Q
 .I (BGPSDX]""&(%="")) S BGPN7=1,BGPVAL=$$DATE^BGP1UTL($P(BGPSDX,U,2))_" SCREEN (20 MONTHS), "_$$DATE^BGP1UTL($P(BGPSDX,U,2))_" USER" Q
 .I ($P(BGPSCPT,U)="1034F")!($P(BGPSCPT,U)="1035F")!($P(BGPSCPT,U)="G0376")!($P(BGPSCPT,U)="G0375")!($P(BGPSCPT,U)=99407) S BGPN7=1,BGPVAL=$$DATE^BGP1UTL($P(BGPSCPT,U,2))_" SCREEN (20 MONTHS), "_$$DATE^BGP1UTL($P(BGPSCPT,U,2))_" USER" Q
 .I $P(BGPSCPT,U)=99406!($P(BGPSCPT,U)="G8455")!($P(BGPSCPT,U)="G8456")!($P(BGPSCPT,U)="G8402")!($P(BGPSCPT,U)="G8453") S BGPN7=1,BGPVAL=$$DATE^BGP1UTL($P(BGPSCPT,U,2))_" SCREEN (20 MONTHS), "_$$DATE^BGP1UTL($P(BGPSCPT,U,2))_" USER" Q
 ;BGPN8 - SMOKER OR NOT
 D
 .I $P(F,U,1)["CURRENT SMOKER"!($P(F,U,1)="CESSATION-SMOKER") S BGPN8=1,BGPVAL=BGPVAL_", "_$P(F,U,2)_" SMOKER" Q
 .I BGPSDX]""&(%="") S BGPN8=1,BGPVAL=BGPVAL_", "_$$DATE^BGP1UTL($P(BGPSDX,U,2))_" SMOKER" Q
 .I $P(BGPSCPT,U)="1034F"!($P(BGPSCPT,U)="G0376")!($P(BGPSCPT,U)="G0375")!($P(BGPSCPT,U)=99407)!($P(BGPSCPT,U)=99406)!($P(BGPSCPT,U)="G8455")!($P(BGPSCPT,U)="G8402")!($P(BGPSCPT,U)="G8453") D
 ..S BGPN8=1,BGPVAL=BGPVAL_", "_$$DATE^BGP1UTL($P(BGPSCPT,U,2))_" SMOKER" Q
 ;BGPN9 - SMOKELESS
 D
 .I $P(F,U,4)="CURRENT SMOKELESS"!($P(F,U,4)="CURRENT SMOKER & SMOKELESS")!($P(F,U,4)="CESSATION-SMOKELESS") S BGPN9=1,BGPVAL=BGPVAL_", "_$P(F,U,5)_" SMOKELESS" Q
 .I $P(BGPSCPT,U)="1035F"!($P(BGPSCPT,U)="G8456") S BGPN9=1,BGPVAL=BGPVAL_", "_$$DATE^BGP1UTL($P(BGPSCPT,U,2))_" SMOKELESS" Q
 ;BGPN5 - ETS
 I $P(F,U,7)="SMOKER IN HOME"!($P(F,U,7)["ENVIRON") S BGPN10=1,BGPVAL=$S(BGPVAL["SCREEN (20 MONTHS)":BGPVAL_", "_$P(F,U,8)_"ETS",1:$P(BGPTOB,U,8)_" SCREEN (20 MONTHS), ETS")
 I BGPN1,BGPVAL="" D
 .I BGPTOB]"" S BGPVAL=$S($P(BGPTOB,U,2)]"":$P(BGPTOB,U,2)_" SCREEN",$P(BGPTOB,U,5)]"":$P(BGPTOB,U,5)_" SCREEN (20 MONTHS)",$P(BGPTOB,U,8)]"":$P(BGPTOB,U,8)_" SCREEN (20 MONTHS)",1:"") Q
 .I BGPSDX]"" S BGPVAL=$$DATE^BGP1UTL($P(BGPSDX,U,2))_" SCREEN (20 MONTHS)" Q
 .I BGPSCPT]"" S BGPVAL=$$DATE^BGP1UTL($P(BGPSCPT,U,2))_" SCREEN (20 MONTHS)" Q
 .I BGPXPBD]"" S BGPVAL=$$DATE^BGP1UTL($P(BGPXPBD,U,2))_" SCREEN (20 MONTHS)" Q
 .I BGP1320]"" S BGPVAL=$$DATE^BGP1UTL($P(BGP1320,U,2))_" SCREEN (20 MONTHS)" Q
 S V=$S(BGPD1:"UP",1:"")_$S(BGPACTCL:",AC",1:"")_$S(BGPD8:",PREG",1:"")
 S BGPVALUE=V_"|||"_BGPVAL
 Q
