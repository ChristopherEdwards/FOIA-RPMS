BGP4DCI ; IHS/CMI/LAB - IHS area GPRA ;
 ;;7.0;IHS CLINICAL REPORTING;;JAN 24, 2007
 ;
CALCIND ;EP
 S BGPIC=0 F  S BGPIC=$O(BGPIND(BGPIC)) Q:BGPIC'=+BGPIC  D
 .I BGPRTYPE=1,$P(^BGPINDF(BGPIC,0),U,7)'=1 Q  ;gpra report
 .I BGPRTYPE=2,$P(^BGPINDF(BGPIC,0),U,8)'=1 Q  ;AREA report
 .I BGPRTYPE=4,BGPINDT="G",$P(^BGPINDF(BGPIC,0),U,7)'=1 Q
 .I BGPRTYPE=4,BGPINDT="A",$P(^BGPINDF(BGPIC,0),U,8)'=1 Q
 .K BGPSTOP
 .I $D(^BGPINDF(BGPIC,1)) X ^BGPINDF(BGPIC,1)
 .K BGPG,BGPC,BGPALLED
 .I $D(BGPSTOP) Q  ;no need to set since no num/denom
 .;loop each individual to set numerator and denominator
 .S BGPI=0 F  S BGPI=$O(^BGPINDFC("B",BGPIC,BGPI)) Q:BGPI'=+BGPI  D
 ..S (BGPNUM,BGPDEN)=0
 ..I BGPRTYPE'=4,BGPINDT="G",$P(^BGPINDFC(BGPI,0),U,5)'=1 Q
 ..I BGPRTYPE'=4,BGPINDT="A",$P(^BGPINDFC(BGPI,0),U,6)'=1 Q
 ..I BGPRTYPE'=4,BGPINDT="H",$P($G(^BGPINDFC(BGPI,12)),U,1)'=1 Q
 ..X ^BGPINDFC(BGPI,1)
 ..X ^BGPINDFC(BGPI,2) ;denominator 1 or 0
 ..;set field counter
 ..S BGPNF=$P(^BGPINDFC(BGPI,0),U,9)
 ..S BGPN=$P(^DD(90244.03,BGPNF,0),U,4),N=$P(BGPN,";"),P=$P(BGPN,";",2)
 ..D S(BGPRPT,BGPGBL,N,P,BGPNUM)
 ..S BGPDF=$P(^BGPINDFC(BGPI,0),U,8)
 ..S BGPN=$P(^DD(90244.03,BGPDF,0),U,4),N=$P(BGPN,";"),P=$P(BGPN,";",2)
 ..I BGPDEN'="NO" D S(BGPRPT,BGPGBL,N,P,BGPDEN)
 .I $D(BGPLIST(BGPIC)) D STMP^BGP4UTL
 ;EISS STUFF COMMENTED OUT FOR NOW
 ;..I BGPRTYPE=2 S D=$P(^BGPINDFC(BGPI,0),U,11),N=$P(^BGPINDFC(BGPI,0),U,14) D
 ;...I BGPTIME=1 D
 ;.... D S $P(^BGPGPDC(BGPRPT,99999,DFN,0),U,D)=BGPDEN
 ;....I N S $P(^BGPGPDC(BGPRPT,99999,DFN,0),U,N)=BGPNUM
 ;...I BGPTIME=2 D
 ;....I D S $P(^BGPGPDP(BGPRPT,99999,DFN,0),U,D)=BGPDEN
 ;....I N S $P(^BGPGPDP(BGPRPT,99999,DFN,0),U,N)=BGPNUM
 ;...I BGPTIME=3 D
 ;....I D S $P(^BGPGPDB(BGPRPT,99999,DFN,0),U,D)=BGPDEN
 ;....I N S $P(^BGPGPDB(BGPRPT,99999,DFN,0),U,N)=BGPNUM
 Q
 ;
S(R,G,N,P,V) ;
 I 'V Q  ;no value to add
 S $P(@(G_R_","_N_")"),U,P)=$P($G(@(G_R_","_N_")")),U,P)+V
 Q
D(D) ;
 I D="" Q ""
 Q $E(D,4,5)_"/"_$E(D,6,7)_"/"_(1700+$E(D,1,3))
