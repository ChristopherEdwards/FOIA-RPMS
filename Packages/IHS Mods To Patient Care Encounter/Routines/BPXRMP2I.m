BPXRMP2I ;IHS/CIA/MGH - Patch 2 inits. ;04-Aug-2005 09:56;MGH
 ;;1.5;CLINICAL REMINDERS;**1002**;Jun 19, 2000
 ;Routine to install immunization reminders
 ;
ENV ;EP environment check
 N PATCH
 S (XPDDIQ("XPZ1"),XPDDIQ("XPZ2"))=0
 ;
 S PATCH="PXRM*1.5*1001"
 I '$$PATCH(PATCH) D  Q
 . W !,"You must first install "_PATCH_"." S XPDQUIT=2
 S (XPDDIQ("XPZ1"),XPDDIQ("XPZ2"))=0
 ;
 S PATCH="BI*8.0*1"
 I '$$PATCH(PATCH) D  Q
 . W !,"You must first install "_PATCH_"." S XPDQUIT=2
 Q
 ;
PATCH(X) ;return 1 if patch X was installed, X=aaaa*nn.nn*nnnn
 ;copy of code from XPDUTL but modified to handle 4 digit IHS patch numb
 Q:X'?1.4UN1"*"1.2N1"."1.2N.1(1"V",1"T").2N1"*"1.4N 0
 NEW NUM,I,J
 S I=$O(^DIC(9.4,"C",$P(X,"*"),0)) Q:'I 0
 S J=$O(^DIC(9.4,I,22,"B",$P(X,"*",2),0)),X=$P(X,"*",3) Q:'J 0
 ;check if patch is just a number
 Q:$O(^DIC(9.4,I,22,J,"PAH","B",X,0)) 1
 S NUM=$O(^DIC(9.4,I,22,J,"PAH","B",X_" SEQ"))
 Q (X=+NUM)
 ;
 ;===============================================================
DELEI ;If the Exchange File entry already exists delete it.
 ;
 N IND,LIST,PXRMVAL,NUM
 ;
 S PXRMVAL(1)="IHS-HEP A ADULT"
 D BDEL
 S PXRMVAL(1)="IHS-HEP B ADULT"
 D BDEL
 S PXRMVAL(1)="IHS-IMMUNIZATION FORECAST"
 D BDEL
 S PXRMVAL(1)="IHS-INFLUENZA IMMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-PED DTAP IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED FLU"
 D BDEL
 S PXRMVAL(1)="IHS-PED HEPA IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED HEPB IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED HIBTITER IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED MMR IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED PEDIARIX IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED PEDVAXHIB IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED PNEUMOVAX IMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-PED POLIO IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED TD IMMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-PED VARICELLA IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PNEUMOVAX IMMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-TD IMMUNIZATION"
 D BDEL
 Q
BDEL D FIND^DIC(811.8,"","","U",.PXRMVAL,"","","","","LIST")
 S NUM=$P(LIST("DILIST",0),U,1)
 I NUM'=0 D
 .F IND=1:1:NUM D
 .. N DA,DIK
 .. S DIK="^PXD(811.8,"
 .. S DA=LIST("DILIST",2,IND)
 .. D ^DIK
 Q
 ;
 ;===============================================================
PRE ;EP Pre-inits
 D DELEI
 Q
 ;
 ;===============================================================
POST ;EP Post-inits
 D SMEXINS
 Q
 ;
 ;===============================================================
SMEXINS ;Silent mode install.
 N IEN,PXRMVAL
 S PXRMVAL(1)="IHS-HEP A ADULT"
 S PXRMVAL(2)="07/28/2005@16:38:30"
 D BBLD
 S PXRMVAL(1)="IHS-HEP B ADULT"
 S PXRMVAL(2)="07/28/2005@16:38:45"
 D BBLD
 S PXRMVAL(1)="IHS-IMMUNIZATION FORECAST"
 S PXRMVAL(2)="07/28/2005@16:39:16"
 D BBLD
 S PXRMVAL(1)="IHS-INFLUENZA IMMUNIZATION"
 S PXRMVAL(2)="07/28/2005@16:39:01"
 D BBLD
 S PXRMVAL(1)="IHS-PED DTAP IMMUN"
 S PXRMVAL(2)="07/28/2005@16:39:40"
 D BBLD
 S PXRMVAL(1)="IHS-PED FLU"
 S PXRMVAL(2)="07/28/2005@16:40:26"
 D BBLD
 S PXRMVAL(1)="IHS-PED HEPA IMMUN"
 S PXRMVAL(2)="07/28/2005@16:39:54"
 D BBLD
 S PXRMVAL(1)="IHS-PED HEPB IMMUN"
 S PXRMVAL(2)="07/28/2005@16:40:11"
 D BBLD
 S PXRMVAL(1)="IHS-PED HIBTITER IMMUN"
 S PXRMVAL(2)="07/28/2005@16:40:48"
 D BBLD
 S PXRMVAL(1)="IHS-PED MMR IMMUN"
 S PXRMVAL(2)="07/28/2005@16:41:03"
 D BBLD
 S PXRMVAL(1)="IHS-PED PEDIARIX IMMUN"
 S PXRMVAL(2)="07/28/2005@16:51:39"
 D BBLD
 S PXRMVAL(1)="IHS-PED PEDVAXHIB IMMUN"
 S PXRMVAL(2)="07/28/2005@16:41:17"
 D BBLD
 S PXRMVAL(1)="IHS-PED PNEUMOVAX IMMUNIZATION"
 S PXRMVAL(2)="07/28/2005@16:41:30"
 D BBLD
 S PXRMVAL(1)="IHS-PED POLIO IMMUN"
 S PXRMVAL(2)="07/28/2005@16:41:49"
 D BBLD
 S PXRMVAL(1)="IHS-PED TD IMMUNIZATION"
 S PXRMVAL(2)="07/28/2005@16:42:05"
 D BBLD
 S PXRMVAL(1)="IHS-PED VARICELLA IMMUN"
 S PXRMVAL(2)="07/28/2005@16:42:20"
 D BBLD
 S PXRMVAL(1)="IHS-PNEUMOVAX IMMUNIZATION"
 S PXRMVAL(2)="07/28/2005@16:42:32"
 D BBLD
 S PXRMVAL(1)="IHS-TD IMMUNIZATION"
 S PXRMVAL(2)="08/04/2005@09:44:19"
 D BBLD
 Q
BBLD ;Do the store
 S IEN=+$$FIND1^DIC(811.8,"","KU",.PXRMVAL)
 I IEN'=0 D
 . N TEXT
 . S TEXT="Installing reminder "_PXRMVAL(1)
 . D BMES^XPDUTL(TEXT)
 . D INSTALL^PXRMEXSI(IEN)
 Q
