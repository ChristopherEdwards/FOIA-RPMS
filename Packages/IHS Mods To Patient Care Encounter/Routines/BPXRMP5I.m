BPXRMP5I ;IHS/CIA/MGH - Patch 3 inits. ;29-Jul-2008 14:45;MGH
 ;;1.5;CLINICAL REMINDERS;**1005**;Jun 19, 2000
 ;Routine to install GPRA reminders
 ;
ENV ;EP environment check
 N IN,PATCH,INSTDA,STAT
 ;Check for the installation of the EHR
 S IN="EHR 1.1",INSTDA=""
 I '$D(^XPD(9.7,"B",IN)) D  Q
 .W !,"You must first install the EHR 1.1 before this patch" S XPDQUIT=2
 S INSTDA=$O(^XPD(9.7,"B",IN,INSTDA),-1)
 S STAT=+$P($G(^XPD(9.7,INSTDA,0)),U,9)
 I STAT'=3 D  Q
 .W !,"EHR 1.1 must be completely installed before installing this patch." S XPDQUIT=2
 S (XPDDIQ("XPZ1"),XPDDIQ("XPZ2"))=0
 ;
 ;Check for the installation of other patches
 S PATCH="PXRM*1.5*1004"
 I '$$PATCH(PATCH) D  Q
 . W !,"You must first install "_PATCH_"." S XPDQUIT=2
 S PATCH="AUPN*99.1*17"
 I '$$PATCH(PATCH) D  Q
 .W !,"You must first install "_PATCH_"." S XPDQUIT=2
 S PATCH="AUM*7.1*1"
 I '$$PATCH(PATCH) D  Q
 .W !,"You must first inatall "_PATCH_"." S XPDQUIT=2
 Q
 ;
PATCH(X) ;return 1 if patch X was installed, X=aaaa*nn.nn*nnnn
 ;copy of code from XPDUTL but modified to handle 4 digit IHS patch numb
 Q:X'?1.4UN1"*"1.2N1"."1.2N.1(1"V",1"T").2N1"*"1.4N 0
 NEW NUM,I,J
 S I=$O(^DIC(9.4,"C",$P(X,"*"),0)) Q:'I 0
 S J=$O(^DIC(9.4,I,22,"B",$P(X,"*",2),0)),X=$P(X,"*",3) Q:'J 0
 ;check if patch is just a number
 Q:$O(^DIC(9.4,I,22,J,"PAH","B",X,0)) 1
 S NUM=$O(^DIC(9.4,I,22,J,"PAH","B",X_" SEQ"))
 Q (X=+NUM)
 ;
 ;===============================================================
DELEI ;If the Exchange File entry already exists delete it.
 ;
 N IND,LIST,PXRMVAL,NUM
 ;
 S PXRMVAL(1)="IHS-HEP A ADULT"
 D BDEL
 S PXRMVAL(1)="IHS-HEP B ADULT"
 D BDEL
 S PXRMVAL(1)="IHS-IMMUNIZATION FORECAST"
 D BDEL
 S PXRMVAL(1)="IHS-INFLUENZA IMMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-INFLUENZA IMMUNIZATION 2007"
 D BDEL
 S PXRMVAL(1)="IHS-PED DTAP IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED FLU"
 D BDEL
 S PXRMVAL(1)="IHS-PED FLU 2007"
 D BDEL
 S PXRMVAL(1)="IHS-PED HEPA IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED HEPB IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED HIBTITER IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED MMR IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED PEDIARIX IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED PEDVAXHIB IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED PNEUMOVAX IMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-PED POLIO IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PED TD IMMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-PED VARICELLA IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-PNEUMOVAX IMMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-TD IMMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-ALCOHOL SCREEN"
 D BDEL
 S PXRMVAL(1)="IHS-ALCOHOL SCREEN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-ALLERGY"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA PLAN"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA PRIM PROV"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA SEVERITY"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA STEROIDS"
 D BDEL
 S PXRMVAL(1)="IHS-BLOOD PRESSURE"
 D BDEL
 S PXRMVAL(1)="IHS-COLON CANCER"
 D BDEL
 S PXRMVAL(1)="IHS-DEPRESSION SCREEN"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB ACE/ARB"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB ASPIRIN"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB DENTAL EXAM"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB EYE EXAM"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB FOOT EXAM"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB HGBA1C"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB MICROALBUMIN"
 D BDEL
 S PXRMVAL(1)="IHS-COLON CANCER 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DEPRESSION SCREEN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB ACE/ARB 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB ASPIRIN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB DENTAL EXAM 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB EYE EXAM 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB FOOT EXAM 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB HGBA1C 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB MICROALBUMIN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DOMESTIC VIOLENCE"
 D BDEL
 S PXRMVAL(1)="IHS-DOMESTIC VIOLENCE 2007"
 D BDEL
 S PXRMVAL(1)="IHS-HCT/HGB"
 D BDEL
 S PXRMVAL(1)="IHS-HEAD CIRCUMFERENCE"
 D BDEL
 S PXRMVAL(1)="IHS-HEARING TEST"
 D BDEL
 S PXRMVAL(1)="IHS-HEIGHT"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK FLU"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK PNEUO"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK FLU 2007"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK FLU 8.1"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK PNEUO 2007"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK PNEUMO 8.1"
 D BDEL
 S PXRMVAL(1)="IHS-LIPID FEMALE"
 D BDEL
 S PXRMVAL(1)="IHS-LIPID MALE"
 D BDEL
 S PXRMVAL(1)="IHS-MAMMOGRAM"
 D BDEL
 S PXRMVAL(1)="IHS-PAP SMEAR"
 D BDEL
 S PXRMVAL(1)="IHS-MAMMOGRAM 2007"
 D BDEL
 S PXRMVAL(1)="IHS-PAP SMEAR 2007"
 D BDEL
 S PXRMVAL(1)="IHS-PPD"
 D BDEL
 S PXRMVAL(1)="IHS-SENIOR HEIGHT"
 D BDEL
 S PXRMVAL(1)="IHS-TOBACCO SCREEN"
 D BDEL
 S PXRMVAL(1)="IHS-TOBACCO SCREEN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-VISION EXAM"
 D BDEL
 S PXRMVAL(1)="IHS-WEIGHT"
 D BDEL
 S PXRMVAL(1)="IHS-MENINGITIS IMMUN"
 D BDEL
 S PXRMVAL(1)="IHS-TDAP IMMUNE"
 D BDEL
 Q
BDEL D FIND^DIC(811.8,"","","U",.PXRMVAL,"","","","","LIST")
 S NUM=$P(LIST("DILIST",0),U,1)
 I NUM'=0 D
 .F IND=1:1:NUM D
 .. N DA,DIK
 .. S DIK="^PXD(811.8,"
 .. S DA=LIST("DILIST",2,IND)
 .. D ^DIK
 Q
 ;
 ;===============================================================
PRE ;EP Pre-inits
 D DELEI
 Q
 ;
 ;===============================================================
POST ;EP Post-inits
 F I=1:1:200 D POSTKIDS^PXRMEXU5(I)
 Q
