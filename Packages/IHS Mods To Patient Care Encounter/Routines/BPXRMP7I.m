BPXRMP7I ;IHS/CIA/MGH - Patch 7 inits. ;23-Sep-2009 16:01;MGH
 ;;1.5;CLINICAL REMINDERS;**1007**;Jun 19, 2000
 ;Routine to install GPRA reminders
 ;
ENV ;EP environment check
 N IN,PATCH,INSTDA,STAT
 ;Check for the installation of the EHR
 S IN="EHR 1.1",INSTDA=""
 I '$D(^XPD(9.7,"B",IN)) D  Q
 .W !,"You must first install the EHR 1.1 before this patch" S XPDQUIT=2
 S INSTDA=$O(^XPD(9.7,"B",IN,INSTDA),-1)
 S STAT=+$P($G(^XPD(9.7,INSTDA,0)),U,9)
 I STAT'=3 D  Q
 .W !,"EHR 1.1 must be completely installed before installing this patch." S XPDQUIT=2
 S (XPDDIQ("XPZ1"),XPDDIQ("XPZ2"))=0
 S IN="IHS PCC SUITE 2.0",INSTDA=""
 I '$D(^XPD(9.7,"B",IN)) D  Q
 .W !,"You must first install the IHS PCC SUITE version 2.0  before this patch" S XPDQUIT=2
 S INSTDA=$O(^XPD(9.7,"B",IN,INSTDA),-1)
 S STAT=+$P($G(^XPD(9.7,INSTDA,0)),U,9)
 I STAT'=3 D  Q
 .W !,"IHS PCC SUITE 2.0  must be completely installed before installing this patch." S XPDQUIT=2
 S (XPDDIQ("XPZ1"),XPDDIQ("XPZ2"))=0
 ;
 ;Check for the installation of other patches
 S PATCH="PXRM*1.5*1006"
 I '$$PATCH(PATCH) D  Q
 . W !,"You must first install "_PATCH_"." S XPDQUIT=2
 S PATCH="BI*8.3*3"
 I '$$PATCH(PATCH) D  Q
 . W !,"You must first install "_PATCH_"." S XPDQUIT=2
 Q
 ;
PATCH(X) ;return 1 if patch X was installed, X=aaaa*nn.nn*nnnn
 ;copy of code from XPDUTL but modified to handle 4 digit IHS patch numb
 Q:X'?1.4UN1"*"1.2N1"."1.2N.1(1"V",1"T").2N1"*"1.4N 0
 NEW NUM,I,J
 S I=$O(^DIC(9.4,"C",$P(X,"*"),0)) Q:'I 0
 S J=$O(^DIC(9.4,I,22,"B",$P(X,"*",2),0)),X=$P(X,"*",3) Q:'J 0
 ;check if patch is just a number
 Q:$O(^DIC(9.4,I,22,J,"PAH","B",X,0)) 1
 S NUM=$O(^DIC(9.4,I,22,J,"PAH","B",X_" SEQ"))
 Q (X=+NUM)
 ;
 ;===============================================================
DELEI ;If the Exchange File entry already exists delete it.
 ;
 N IND,LIST,PXRMVAL,NUM
 ;
 S PXRMVAL(1)="IHS-DOMESTIC VIOLENCE 2009"
 D BDEL
 S PXRMVAL(1)="IHS-DOMESTIC VIOLENCE 2008"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB ASPIRIN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA PLAN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA PRIM PROV 2007"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA SEVERITY 2007"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA STEROID 2007"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA PLAN"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA SEVERITY"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA STEROID"
 D BDEL
 S PXRMVAL(1)="IHS-EPSDT EVALUATION"
 D BDEL
 S PXRMVAL(1)="IHS-HEARING TEST 2009"
 D BDEL
 S PXRMVAL(1)="IHS-HEARING TEST"
 D BDEL
 S PXRMVAL(1)="IHS-MAMMOGRAM 2009"
 D BDEL
 S PXRMVAL(1)="IHS-MAMMOGRAM 2008"
 D BDEL
 S PXRMVAL(1)="IHS-OSTEOPOROSIS SCREENING"
 D BDEL
 S PXRMVAL(1)="IHS-PAP SMEAR 2009"
 D BDEL
 S PXRMVAL(1)="IHS-PAP SMEAR 2008"
 D BDEL
 S PXRMVAL(1)="IHS-SENIOR VISION 2009"
 D BDEL
 S PXRMVAL(1)="IHS-TOBACCO SCREEN 2009"
 D BDEL
 S PXRMVAL(1)="IHS-TOBACCO SCREEN 2008"
 D BDEL
 S PXRMVAL(1)="IHS-ALCOHOL SCREEN 2008"
 D BDEL
 S PXRMVAL(1)="IHS-ALCOHOL SCREEN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB FOOT EXAM 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB FOOT EXAM 2008"
 D BDEL
 S PXRMVAL(1)="IHS-DOMESTIC VIOLENCE 2008"
 D BDEL
 S PXRMVAL(1)="IHS-DOMESTIC VIOLENCE 2007"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK FLU IMMUN 2008"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK PNEUMO IMMUN 2008"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK FLU 2007"
 D BDEL
 S PXRMVAL(1)="IHS-HIGH RISK PNEUO 2007"
 D BDEL
 S PXRMVAL(1)="IHS-TOBACCO SCREEN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-TDAP IMMUN 2008"
 D BDEL
 S PXRMVAL(1)="IHS-MAMMOGRAM 2008"
 D BDEL
 S PXRMVAL(1)="IHS-MAMMOGRAM 2007"
 D BDEL
 S PXRMVAL(1)="IHS-DEPRESSION SCREEN 2007"
 D BDEL
 S PXRMVAL(1)="IHS-PAP SMEAR 2007"
 D BDEL
 S PXRMVAL(1)="IHS-HPV IMMUN 2008"
 D BDEL
 S PXRMVAL(1)="IHS-HPV IMMUNIZATION"
 D BDEL
 S PXRMVAL(1)="IHS-PED ROTAVIRUS IMMUN 2008"
 D BDEL
 S PXRMVAL(1)="IHS-ALCOHOL SCREEN 2009"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA CONTROL 2008"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA PLAN 2009"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA PRIM PROV 2009"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA RISK EXACERBATION"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA SEVERITY 2009"
 D BDEL
 S PXRMVAL(1)="IHS-ASTHMA STEROID 2009"
 D BDEL
 S PXRMVAL(1)="IHS-DEPRESSION SCREEN 2009"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB ASPIRIN 2009"
 D BDEL
 S PXRMVAL(1)="IHS-DIAB DENTAL EXAM"
 D BDEL
 S PXRMVAL(1)="IHS-DENTAL VISIT"
 D BDEL
 S PXRMVAL(1)="IHS-DIABETES SCREENING"
 D BDEL
 Q
BDEL D FIND^DIC(811.8,"","","U",.PXRMVAL,"","","","","LIST")
 S NUM=$P(LIST("DILIST",0),U,1)
 I NUM'=0 D
 .F IND=1:1:NUM D
 .. N DA,DIK
 .. S DIK="^PXD(811.8,"
 .. S DA=LIST("DILIST",2,IND)
 .. D ^DIK
 Q
 ;
 ;===============================================================
PRE ;EP Pre-inits
 D DELEI
 Q
 ;
 ;===============================================================
POST ;EP Post-inits
 F I=1:1:200 D POSTKIDS^PXRMEXU5(I)
 Q
