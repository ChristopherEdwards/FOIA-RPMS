AGUTL ;IHS/OIT/NKD - PAT REG UTILITY ROUTINE ; FEBRUARY 10, 2014
 ;;7.1;PATIENT REGISTRATION;**11**;AUG 25, 2005;Build 1
 ;IHS/OIT/NKD AG*7.1*11 MU2 MULTIPLE RACES
 ;IHS/OIT/NKD AG*7.1*11 MU2 UNKNOWN SEX
 ;IHS/OIT/NKD AG*7.1*11 VAMB
 ;
 Q
RACE(AGPATDFN) ;EP - RETURN LIST OF PATIENT'S RACES (EXTERNAL FORMAT)
 ; # OF RACES^RACE 1^RACE 2^ETC
 ; EX: PT W/0 RACES => "0"
 ; EX: PT W/2 RACES => "2^AMERICAN INDIAN OR ALASKA NATIVE^ASIAN"
 N AGRACE,AGLIST,AGCNT
 D LIST^DIC(2.02,","_AGPATDFN_",","@;.01E","P",,,,,,,"AGRACE")
 S AGLIST=$P(AGRACE("DILIST",0),"^",1)
 F AGCNT=1:1:$P(AGRACE("DILIST",0),"^",1) S AGLIST=AGLIST_"^"_$P(AGRACE("DILIST",AGCNT,0),"^",2)
 Q AGLIST
SEXELIG(AGPATDFN) ;EP - UPDATES PATIENT-SPECIFIC ELIGIBILITY SEX/GENDER FIELDS TO PATIENT'S SEX
 ; MEDICARE/MEDICAID/RAILROAD ELIGIBLE FILES ARE ASSOCIATED WITH A PATIENT
 ; CALLING THIS API WILL UPDATE THE SEX/GENDER FIELDS IN THE ELIGIBLE FILES TO MATCH THE PATIENT'S SEX
 Q:'AGPATDFN
 N AGSEX,AGPTR,AGPTR2
 S AGSEX=$$GET1^DIQ(2,AGPATDFN,.02,"I")
 Q:AGSEX']""
 ; MCR
 S AGPTR=0 F  S AGPTR=$O(^AUPNMCR("B",AGPATDFN,AGPTR)) Q:'AGPTR  D
 . Q:'$D(^AUPNMCR(AGPTR,0))
 . Q:AGPATDFN'=$$GET1^DIQ(9000003,AGPTR,.01,"I")
 . N FDA
 . S AGPTR2=0 F  S AGPTR2=$O(^AUPNMCR(AGPTR,11,AGPTR2)) Q:'AGPTR2  S FDA(9000003.11,AGPTR2_","_AGPTR_",",.08)=AGSEX
 . I $D(FDA) D UPDATE^DIE(,"FDA")
 ; MCD
 S AGPTR=0 F  S AGPTR=$O(^AUPNMCD("B",AGPATDFN,AGPTR)) Q:'AGPTR  D
 . Q:'$D(^AUPNMCD(AGPTR,0))
 . Q:AGPATDFN'=$$GET1^DIQ(9000004,AGPTR,.01,"I")
 . N FDA
 . S FDA(9000004,AGPTR_",",.07)=AGSEX
 . D UPDATE^DIE(,"FDA")
 ; RRE
 S AGPTR=0 F  S AGPTR=$O(^AUPNRRE("B",AGPATDFN,AGPTR)) Q:'AGPTR  D
 . Q:'$D(^AUPNRRE(AGPTR,0))
 . Q:AGPATDFN'=$$GET1^DIQ(9000005,AGPTR,.01,"I")
 . N FDA
 . S AGPTR2=0 F  S AGPTR2=$O(^AUPNRRE(AGPTR,11,AGPTR2)) Q:'AGPTR2  S FDA(9000005.11,AGPTR2_","_AGPTR_",",.08)=AGSEX
 . I $D(FDA) D UPDATE^DIE(,"FDA")
 Q
INSTYP(AGIEN) ;EP - RETURN INSURER TYPE CODE
 N AGRES
 S AGRES=$$GET1^DIQ(9999999.18,AGIEN,.211,"I")
 S AGRES=$$GET1^DIQ(9999999.181,AGRES,1,"I")
 Q AGRES
