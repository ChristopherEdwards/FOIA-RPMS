BCHULV ; IHS/TUCSON/LAB - PTS LAST CHR VISIT ;  [ 10/28/96  2:05 PM ]
 ;;1.0;IHS RPMS CHR SYSTEM;;OCT 28, 1996
 ;
 ;
START ;EP display patients last visit
 D GETPAT
 I 'BCHPAT D XIT Q
 D GETREC
 I 'BCHR D XIT Q
 D FORMAT
 Q:BCHTYPE=""
ZIS ;
 S XBRC="COMP^BCHULV",XBRP=$S(BCHTYPE="C":"PRINT1^BCHUFPP",1:"^BCHUDSP"),XBNS="BCH",XBRX="XIT^BCHULV"
 D ^XBDBQUE
 D XIT
 Q
XIT ;
 D KILL^AUPNPAT
 K BCHVDFN,BCHVDG,BCHVDSH,BCHVFU,BCHVI,BCHVIGR,BCHVL,BCHVNM,BCHX,BCHBRK,BCHTYPE,BCHDLAST,BCHR11,BCHR12,BCHRNODE,BCHRPRNM
 K ZTSK,Y,BCHBD,BCHED,IO("Q"),BCH80D,BCHBTH,BCHHRCN,BCHJOB,BCHUNG,BCHPCNT,BCHPG,BCHPROV,BCHX,DFN,DIC,DIR,DIRUT,DTOUT,DUOUT,XBNS,XBRC,XBRP,XBTX,D,BCHC
 K BCHPRNM,BCHPRNT,BCHPROB,BCHPRV,BCHR,BCHRCNT,BCHRLOC,BCHSD,BCHTOT,BCHBDD,BCHBT,BCHEDD,BCHEDO,BCHBDO,BCHBT,BCHFOUND,BCHHIT,BCHID,BCHLINE,BCHP,BCHHRN,BCHODAT,BCHQUIT,BCHR0,BCHTICL,BCHTNRQ,BCHTQ,BCHTTXT
 K BCHPAT
 Q
GETPAT ; GET PATIENT
 S BCHPAT=""
 S DIC("A")="Enter PATIENT (if known): ",DIC="^AUPNPAT(",DIC(0)="AEMQ" D ^DIC K DIC
 Q:Y<0
 S BCHPAT=+Y
 Q
 ;
GETREC ;
 S BCHR=""
 I '$D(^BCHR("AE",BCHPAT)) W !!,"No records on file for this patient.",! Q
 S BCHDLAST=$O(^BCHR("AE",AUPNPAT,"")),BCHR=$O(^BCHR("AE",AUPNPAT,BCHDLAST,""))
 Q
FORMAT ;
 S BCHTYPE=""
 S DIR(0)="S^C:CHR PCC Form Format;S:Standard Display",DIR("A")="Select Print Format",DIR("B")="C" D ^DIR K DIR S:$D(DUOUT) DIRUT=1
 Q:$D(DIRUT)
 S BCHTYPE=Y
 Q
COMP ;
 Q
