BKMVSSR1 ;PRXM/HC/CLT - STATE SURV. REPORT DATA GATHER CONTINUED ; 31 Mar 2005  3:50 PM
 ;;2.1;HIV MANAGEMENT SYSTEM;;Feb 07, 2011
 ;
 ;
EN ;EP - PRIMARY ENTRY INTO THIS ROUTINE
 D CDC,LABS,CPT,ICD,STATEICD
 Q
CDC ;GATHER CDC ETIOLOGY DATA
 Q:IEN=""  ; Required HMS REGISTRY IEN
 S BKMVETO=$$GET1^DIQ(90451.01,"1,"_IEN,7,"E")
 Q
LABS ;GATHER LAB/LOINC DATA FOR THE REPORT (using Taxonomy)
 S GLOBAL="BKMVLABS(VSTDT,TEST,""LAB"")"
 D LABTAX^BKMIXX(DFN,"BGP CD4 TAX","","",GLOBAL)
 D LABTAX^BKMIXX(DFN,"BGP HIV TEST TAX","","",GLOBAL)
 D LABTAX^BKMIXX(DFN,"BGP HIV VIRAL LOAD TAX","","",GLOBAL)
 D LOINC^BKMIXX(DFN,"BGP CD4 LOINC CODES","","",GLOBAL)
 D LOINC^BKMIXX(DFN,"BGP HIV TEST LOINC CODES","","",GLOBAL)
 D LOINC^BKMIXX(DFN,"BGP VIRAL LOAD LOINC CODES","","",GLOBAL)
 Q
CPT ;GATHER CPT (LAB) DATA FOR VIRAL LOAD (using Taxonomy)
 S GLOBAL="BKMVLABS(VSTDT,TEST,""CPT"")"
 D CPTTAX^BKMIXX(DFN,"BGP CD4 CPTS","","",GLOBAL)
 D CPTTAX^BKMIXX(DFN,"BGP CPT HIV TESTS","","",GLOBAL)
 D CPTTAX^BKMIXX(DFN,"BGP HIV VIRAL LOAD CPTS","","",GLOBAL)
 Q
ICD ;FIND ICD DIAGNOSIS (using Taxonomy)
 S GLOBAL="BKMICD(VSTDT,TEST,""POV"")"
 D ICDTAX^BKMIXX1(DFN,"BGP HIV/AIDS DXS","","",GLOBAL)
 S GLOBAL="BKMICD(VSTDT,TEST,""PROB"")"
 D PRBTAX^BKMIXX(DFN,"BGP HIV/AIDS DXS","","",GLOBAL)
 Q
STATEICD ;GATHER STATE REPORTABLE ICD'S (using Taxonomy)
 S BKMCKDT=$$FMADD^XLFDT(DT,-360)
 S GLOBAL="BKMSICD(VSTDT,TEST,""POV"")"
 D ICDTAX^BKMIXX1(DFN,"BKM STATE REPORTABLE DXS","",BKMCKDT,GLOBAL)
 S GLOBAL="BKMSICD(VSTDT,TEST,""PROB"")"
 D PRBTAX^BKMIXX(DFN,"BKM STATE REPORTABLE DXS","",BKMCKDT,GLOBAL)
 Q
