AFSLDIQ2 ;IHS/OIRM/DSD/JDM - DOC# INQUIRY LOOKUP; [ 10/27/2004   4:21 PM ]
 ;;3.0t1;1166 APPROVALS FOR PAYMENT;**13**;
 ;;MODIFIED FOR CACHE' COMPLIANCE ACR*2.1*9
 ;Allows viewing of document and payment history - part 2
 ;ACR*2.1*13.02 IM13574    ;REMOVED DUPLICATE SUBROUTINES
 K AFSLDFND,AFSLDNOD,AFSLDZRO,AFSLTDOC
 K ^TMP("AFSLOTMP",$J)
 S AFSLDNOD=99999
 S AFSLTDCT=1
 S (AFSLDNX,AFSLSTRT,AFSLDNXS)=0
 S AFSLDNX=AFSLDOC-1
DOIT ;
 I '$D(^AFSLODOC(AFSLYNOD,1,"B",AFSLDOC)) S Y=-1 G FINI
 S AFSLDNXS=$O(^AFSLODOC(AFSLYNOD,1,"B",AFSLDOC,0))
 S AFSLDNOD=AFSLDNXS
 K AFSLX
 S $P(AFSLX,U,1)=AFSLTDCT
 S $P(AFSLX,U,2)=$P($G(^AFSLODOC(AFSLYNOD,1,AFSLDNOD,2)),U,1)
 S $P(AFSLX,U,3)=AFSLDNOD
 S $P(AFSLX,U,4)=^AFSLODOC(AFSLYNOD,1,AFSLDNOD,0)
 S ^TMP("AFSLOTMP",$J,AFSLTDCT)=AFSLX
DOITLP2 ;
 I '$O(^AFSLODOC(AFSLYNOD,1,"B",AFSLDOC,AFSLDNXS)) G CHKDOC
 S AFSLDNDN=$O(^AFSLODOC(AFSLYNOD,1,"B",AFSLDOC,AFSLDNXS))
 S AFSLTDCT=AFSLTDCT+1
 K AFSLX
 S $P(AFSLX,U,1)=AFSLTDCT
 S $P(AFSLX,U,2)=$P($G(^AFSLODOC(AFSLYNOD,1,AFSLDNDN,2)),U,1)
 S $P(AFSLX,U,3)=AFSLDNDN
 S $P(AFSLX,U,4)=^AFSLODOC(AFSLYNOD,1,AFSLDNDN,0)
 S ^TMP("AFSLOTMP",$J,AFSLTDCT)=AFSLX
 S AFSLDNXS=AFSLDNDN
 G DOITLP2
CHKDOC ;
 I '$D(^TMP("AFSLOTMP",$J,1)) S Y=-1 G FINI
DSPHDR ;
 D ^XBCLS
 S DY=2,DX=18
 X XY
 W @AFSLRVON,"VERIFY DOCUMENT SELECTION FOR 1166 PAYMENT",@AFSLRVOF
 S DY=5
 S DX=2
 X XY
 W @AFSLRVON,"SEQ#",@AFSLRVOF,"  "
 W @AFSLRVON,"REF.",@AFSLRVOF,"  "
 W @AFSLRVON,"DOCUMENT #",@AFSLRVOF,"  "
 W @AFSLRVON,"EFF.DATE",@AFSLRVOF
 W "  "
 W @AFSLRVON,"CAN NO.",@AFSLRVOF,"  "
 W @AFSLRVON,"CLASS",@AFSLRVOF,"  "
 W @AFSLRVON,"TYPE",@AFSLRVOF,"  "
 W @AFSLRVON,"FED",@AFSLRVOF,"  "
 W @AFSLRVON,"OBLIGATION $$",@AFSLRVOF
 S DY=6
 F I=1:1:999 Q:AFSLENUF["^"  I $D(^TMP("AFSLOTMP",$J,I)) D DSPDOCS
SELDOC ;
 S AFSLLTH=$L(AFSLTDCT)
 S AFSLDOCC="^"
 S DY=22
 S DX=23
 X XY
 S DX=53                                        ; ACR*2.1*13.02 IM13574
 X XY                                           ; ACR*2.1*13.02 IM13574
 W *7,@AFSLRVON                                 ; ACR*2.1*13.02 IM13574
 S DIR(0)="L^1:"_AFSLTDCT                       ; ACR*2.1*13.02 IM13574
 S DIR("A")="ENTER SEQ# OR ""^"" TO ABORT ^//"  ; ACR*2.1*13.02 IM13574
 D DIR^ACRFDIC                                  ; ACR*2.1*13.02 IM13574
 W @AFSLRVOF                                    ; ACR*2.1*13.02 IM13574
 I $D(ACRQUIT)!($D(ACROUT)) D  G FINI           ; ACR*2.1*13.02 IM13574
 .S AFSLCONT=U                                  ; ACR*2.1*13.02 IM13574
 S AFSLDOCC=Y                                   ; ACR*2.1*13.02 IM13574
 I AFSLDOCC'?.N!(AFSLDOCC>AFSLTDCT)!(AFSLDOCC<1) D  G SELDOC
 .S DY=23
 .S DX=7
 .X XY
 .W @AFSLRVON                                   ; ACR*2.1*13.02 IM13574
 .W *7,"**** MUST ENTER ONE OF THE SEQUENCE NUMBERS ABOVE OR ""^"" ****"
 W @AFSLRVOF
 S AFSLDOCC=$P(^TMP("AFSLOTMP",$J,+AFSLDOCC),U,3)
 S Y=1
FINI ;
 I '$D(Y) Q
 I Y=-1 S AFSLDOCC=""
 QUIT
DSPDOCS ;
 S DY=DY+1
 I DY=20 D
 .W *7
 .S DIR(0)="YO"
 .S DIR("A",1)="ENTER '^' TO STOP VIEWING"
 .S DIR("A")="PRESS RETURN FOR MORE"
 .D ^DIR
 .S AFSLENUF=X
 .F L=7:1:21 D
 ..S DY=L
 ..S DX=2
 ..X XY
 ..W "                                                                            "
 I DY=21 S DY=7
 S:$P(^TMP("AFSLOTMP",$J,I),U,13)="" $P(^TMP("AFSLOTMP",$J,I),U,13)="000000000000"
 S AFSLTDOL=$P(^TMP("AFSLOTMP",$J,I),U,13)
 S AFSLTDOL=$E(AFSLTDOL,2,11)_"."_$E(AFSLTDOL,12,13)
 S $P(^TMP("AFSLOTMP",$J,I),U,13)=AFSLTDOL
 K AFSLX
 S AFSLX=^TMP("AFSLOTMP",$J,I)
 S DX=2
 X XY
 W $P(AFSLX,U,1)
 S DX=8
 X XY
 W $P(AFSLX,U,2)
 S DX=14
 X XY
 W $P(AFSLX,U,4)
 S DX=27
 X XY
 W $P(AFSLX,U,12)
 S DX=36
 X XY
 W $P(AFSLX,U,6)
 S DX=45
 X XY
 W $P(AFSLX,U,7)
 S DX=53
 X XY
 W $P(AFSLX,U,9)
 S DX=59
 X XY
 W $P(AFSLX,U,8)
 S DX=63
 X XY
 W $P(AFSLX,U,13)
 Q
XXX ;
 ;I '$D(^AFSLODOC(AFSLYNOD,1,"B",AFSLDOC)) S Y=-1 G FINI
 F  S AFSLDNXS=$O(^AFSLODOC(AFSLYNOD,1,"B",AFSLDOC,AFSLDNXS)) Q:'AFSLDNXS  D
 .S AFSLDNOD=AFSLDNXS
 .K AFSLX
 .S $P(AFSLX,U,1)=AFSLTDCT
 .S $P(AFSLX,U,2)=$P($G(^AFSLODOC(AFSLYNOD,1,AFSLDNOD,2)),U,1)
 .S $P(AFSLX,U,3)=AFSLDNOD
 .S $P(AFSLX,U,4)=^AFSLODOC(AFSLYNOD,1,AFSLDNOD,0)
 .S ^TMP("AFSLOTMP",$J,AFSLTDCT)=AFSLX
 .S AFSLTDCT=AFSLTDCT+1
 Q
