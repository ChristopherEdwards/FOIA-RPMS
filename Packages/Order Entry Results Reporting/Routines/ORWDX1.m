ORWDX1 ; SLC/KCM/REV - Utilities for Order Dialogs ;28-JAN-1999 12:37
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,187**;Dec 17, 1997
 ;
WRLST(LST,LOC) ; Return list of dialogs for writing orders
 ; .Y(n): DlgName^ListBox Text
WRLST1 N ANENT
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
 S ANENT="ALL^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
 D WRLSTB(.LST) Q:$D(LST)>1  ; check ORWDX WRITE ORDERS first
 N ORX,X0,X5,ORERR,I,SEQ,IEN,DGRP,FID,TXT,TYP
 D GETLST^XPAR(.ORX,ANENT,"ORWOR WRITE ORDERS LIST","Q",.ORERR) Q:ORERR
 S I=0 F  S I=$O(ORX(I)) Q:'I  D
 . S SEQ=+ORX(I),IEN=$P(ORX(I),U,2),X0=^ORD(101.41,IEN,0),X5=$G(^(5))
 . S DGRP=+$P(X0,U,5),FID=+$P(X5,U,5),TXT=$P(X5,U,4),TYP=$P(X0,U,4)
 . S:'$L(TXT) TXT=$P(X0,U,2)
 . I $P(X0,U,4)="M" S:'FID FID=1001
 . S LST(SEQ)=IEN_";"_FID_";"_DGRP_";"_TYP_U_TXT
 Q
WRLSTB(LST)     ; return menu from which Write Orders list is built
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS LIST",1,"I") Q:'MNU
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
 . . S:'$L(TXT) TXT=$P(X,U,2)
 . . I TYP="M" S:'FID FID=1001
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
 Q
DELPI ; delete PI from ORDIALOG if PI = ""
 ;Called from SAVE^ORWDX
 N ORPI S ORPI=0
 S ORPI=$O(^ORD(101.41,"B","OR GTX PATIENT INSTRUCTIONS",ORPI))
 Q:'$D(ORDIALOG(ORPI))
 I '$D(ORDIALOG(ORPI,1)) K ORDIALOG(ORPI),ORDIALOG("WP",ORPI) Q
 N PINODE,PITX
 S PITX="",PINODE=$G(ORDIALOG(ORPI,1))
 S PITX=$G(@PINODE@(1,0))
 S PITX=$TR(PITX," ","")
 I '$L(PITX) K ORDIALOG(ORPI),ORDIALOG("WP",ORPI)
 Q
