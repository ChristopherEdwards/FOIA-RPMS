AMQQF ; IHS/CMI/THL - STORES ANALYTIC FUNCTIONS ;
 ;;2.0;IHS PCC SUITE;;MAY 14, 2009
 ;-----
TEST N T
 S T=$T
 I '$D(AMQQNOT)=T K ^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)
EXIT Q
 ;
AVE N Y,Z,I
 S Y=0
 S Z=0
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  I +^(I) S Y=Y+1,Z=+^(I)+Z
 K ^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN)
 I Y S ^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,1)=$J((Z/Y),1,1)
 Q
 ;
SPAN N A,B,I,N,%,X S I=0
 F X=0:0 S X=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,X)) Q:'X  S %=+^(X) S:'$D(A) (A,B)=% S:%<A A=% S:%>B B=% S I=I+1
 K ^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN)
 I I>1 S ^(AMQQUATN,1)=B-A
 Q
 ;
EXIST I $D(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN)) K ^(AMQQUATN) S ^(AMQQUATN,1)="+"
 Q
 ;
NULL I '$D(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN)) S ^(AMQQUATN,1)="NULL"
 Q
 ;
GRT N I
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  D GRT1,TEST
 K AMQQNOT
 Q
 ;
GRT1 I +^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)'>AMQQCOMP
 Q
 ;
LESS N I
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  D LESS1,TEST
 K AMQQNOT
 Q
 ;
LESS1 I +^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)'<AMQQCOMP
 Q
 ;
EQUAL N I
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  D EQUAL1,TEST
 K AMQQNOT
 Q
 ;
EQUAL1 I $E(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I))?1N S $P(^(I),U,1)=+^(I)
 I $P(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I),U)'=AMQQCOMP
 Q
 ;
STARTW N X,Y,Z,I
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  D STARTW1,TEST
 K AMQQNOT
 Q
 ;
STARTW1 S X=$P(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I),U)
 I $E(X,1,$L(AMQQCOMP))'=AMQQCOMP
 Q
 ;
ENDW S X=$P(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I),U)
 Q:'I
 D ENDW1,TEST
 Q
 ;
ENDW1 S X=$P(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I),U)
 I $E(X,$L(X)-$L(AMQQCOMP)+1,255)'=AMQQCOMP
 Q
 ;
BET N I,X,Y
 S X=$P(AMQQCOMP,";")
 S Y=$P(AMQQCOMP,";",2)
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  D BET1,TEST
 K AMQQNOT
 Q
 ;
BET1 I +^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)<X!(+^(I)>Y)
 Q
 ;
ALL ;
SAVE ;
 Q
 ;
LEAST N I,Y S Y=0
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  S Y=Y+1
 I AMQQCOMP>Y K ^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN)
 Q
 ;
MOST N I,Y
 S Y=0
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  S Y=Y+1
 I AMQQCOMP<Y K ^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN)
 Q
 ;
TOTAL N X,Y,Z,I
 S Y=0,Z=0
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  I ^(I)'="" S Y=Y+1
 K ^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN),AMQQTOTF(AMQQFVAR)
 I Y S ^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,1)=Y,AMQQTOTF(AMQQFVAR)=""
 Q
 ;
CONTX N I
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  D CONTX1,TEST
 K AMQQNOT
 Q
 ;
CONTX1 I $P(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I),U)'[AMQQCOMP
 Q
 ;
FOLTX N I
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  D FOLTX1,TEST
 K AMQQNOT
 Q
 ;
FOLTX1 I $P(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I),U)']AMQQCOMP
 D TEST
 Q
 ;
PATTERN N I,X,Y,Z
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  D PAT1,TEST
 K AMQQNOT
 Q
 ;
PAT1 S X="I $P(^UTILITY(""AMQQ"",$J,AMQQAG,AMQQUATN,I),U)'?"_AMQQCOMP
 X X
 Q
 ;
BETD N I,X,Y,Z
 S Z=$P(AMQQCOMP,";",2)
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  S Y=$P(^(I),U,2) D BETD1,TEST
 K AMQQNOT
 Q
 ;
BETD1 I Y<+AMQQCOMP!(Y>Z)
 Q
 ;
AFTER N I,X,Y
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  S Y=$P(^(I),U,2) D AFT1,TEST
 K AMQQNOT
 Q
 ;
AFT1 I Y'>AMQQCOMP
 Q
 ;
ON N I,X,Y
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  S Y=$P(^(I),U,2) D ON1,TEST
 K AMQQNOT
 Q
 ;
ON1 I Y\1'=+AMQQCOMP\1
 Q
 ;
BEFORE N I,X,Y
 F I=0:0 S I=$O(^UTILITY("AMQQ",$J,AMQQAG,AMQQUATN,I)) Q:'I  S Y=$P(^(I),U,2) D BEF1,TEST
 K AMQQNOT
 Q
 ;
BEF1 I Y'<AMQQCOMP
 Q
 ;
