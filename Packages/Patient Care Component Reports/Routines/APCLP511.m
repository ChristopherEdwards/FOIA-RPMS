APCLP511 ; IHS/CMI/LAB -IHS -CUMULATIVE REPORT ;
 ;;2.0;IHS PCC SUITE;;MAY 14, 2009
 ;
 ;
EKG ;need date of last ekg
 S:'$D(APCLCUML(150)) APCLCUML(150)="EKG"
 S $P(APCLCUML(150),U,2)=$P(APCLCUML(150),U,2)+1
 S V=$$EKG^APCLP512(APCLPD,APCLRED,"I")
 I V]"" D
 .S E=$$FMDIFF^XLFDT(APCLADAT,V)
 .I E<(365.25*3) S $P(APCLCUML(150),U,3)=$P(APCLCUML(150),U,3)+1
 .I E<(365.25*5) S $P(APCLCUML(150),U,4)=$P(APCLCUML(150),U,4)+1
 .S $P(APCLCUML(150),U,5)=$P(APCLCUML(150),U,5)+1
TCHOL ;
 S:'$D(APCLCUML(180)) APCLCUML(180)="Total Cholesterol obtained in past 12 months"
 S $P(APCLCUML(180),U,2)=$P(APCLCUML(180),U,2)+1
 S V=$$CHOL^APCLD518(APCLPD,APCLBDAT,APCLADAT,"I")
 I V="" S $P(APCLCUML(180),U,6)=$P(APCLCUML(180),U,6)+1 G LDL
 S V=$P(V,U)
 I $E(V)'=+$E(V) S $P(APCLCUML(180),U,7)=$P(APCLCUML(180),U,7)+1 G LDL ;unable to determine result, not a number or is blank
 I V<200 S $P(APCLCUML(180),U,3)=$P(APCLCUML(180),U,3)+1
 I V<240&(V>199) S $P(APCLCUML(180),U,4)=$P(APCLCUML(180),U,4)+1
 I V>239 S $P(APCLCUML(180),U,5)=$P(APCLCUML(180),U,5)+1
LDL ;
 S:'$D(APCLCUML(190)) APCLCUML(190)="LDL Cholesterol obtained in the past 12 months"
 S $P(APCLCUML(190),U,2)=$P(APCLCUML(190),U,2)+1
 S V=$$LDL^APCLD518(APCLPD,APCLBDAT,APCLADAT,"I")
 I V="" S $P(APCLCUML(190),U,7)=$P(APCLCUML(190),U,7)+1 G HDL
 S V=$P(V,U)
 I $E(V)'=+$E(V) S $P(APCLCUML(190),U,8)=$P(APCLCUML(190),U,8)+1 G HDL ;unable to determine result, not a number or blank
 I V<100 S $P(APCLCUML(190),U,3)=$P(APCLCUML(190),U,3)+1
 I V<130&(V>99) S $P(APCLCUML(190),U,4)=$P(APCLCUML(190),U,4)+1
 I V>129&(V<161) S $P(APCLCUML(190),U,5)=$P(APCLCUML(190),U,5)+1
 I V>160 S $P(APCLCUML(190),U,6)=$P(APCLCUML(190),U,6)+1
HDL ;
 S:'$D(APCLCUML(195)) APCLCUML(195)="HDL Cholesterol obtained in the past 12 months"
 S $P(APCLCUML(195),U,2)=$P(APCLCUML(195),U,2)+1
 S V=$$HDL^APCLD518(APCLPD,APCLBDAT,APCLADAT,"I")
 I V="" S $P(APCLCUML(195),U,7)=$P(APCLCUML(195),U,7)+1 G TRIG
 S V=$P(V,U)
 I $E(V)'=+$E(V) S $P(APCLCUML(195),U,8)=$P(APCLCUML(195),U,8)+1 G TRIG ;unable to determine result, not a number
 S V=$P(V,".")
 I V<35 S $P(APCLCUML(195),U,3)=$P(APCLCUML(195),U,3)+1
 I V<46&(V>34) S $P(APCLCUML(195),U,4)=$P(APCLCUML(195),U,4)+1
 I V>45&(V<56) S $P(APCLCUML(195),U,5)=$P(APCLCUML(195),U,5)+1
 I V>55 S $P(APCLCUML(195),U,6)=$P(APCLCUML(195),U,6)+1
TRIG ;
 S:'$D(APCLCUML(200)) APCLCUML(200)="Triglycerides obtained in past 12 months"
 S $P(APCLCUML(200),U,2)=$P(APCLCUML(200),U,2)+1
 S V=$$TRIG^APCLD518(APCLPD,APCLBDAT,APCLADAT,"I")
 I V="" S $P(APCLCUML(200),U,7)=$P(APCLCUML(200),U,7)+1 G FAST
 S V=$P(V,U)
 I $E(V)'=+$E(V) S $P(APCLCUML(200),U,8)=$P(APCLCUML(200),U,8)+1 G FAST ;unable to determine result, not a number
 I V<150 S $P(APCLCUML(200),U,3)=$P(APCLCUML(200),U,3)+1
 I V<200&(V>149) S $P(APCLCUML(200),U,4)=$P(APCLCUML(200),U,4)+1
 I V>199&(V<401) S $P(APCLCUML(200),U,5)=$P(APCLCUML(200),U,5)+1
 I V>400 S $P(APCLCUML(200),U,6)=$P(APCLCUML(200),U,6)+1
FAST ;
 S:'$D(APCLCUML(600)) APCLCUML(600)="Fasting Glucose obtained ever"
 S $P(APCLCUML(600),U,2)=$P(APCLCUML(600),U,2)+1
 S V=$$FGLUCOSE^APCLD518(APCLPD,$P(^DPT(APCLPD,0),U,3),APCLADAT,"I")
 I V="" S $P(APCLCUML(600),U,7)=$P(APCLCUML(600),U,7)+1 G G75
 S V=$P(V,U)
 I $E(V)'=+$E(V) S $P(APCLCUML(600),U,8)=$P(APCLCUML(600),U,8)+1 G G75 ;unable to determine result, not a number
 S $P(APCLCUML(600),U,3)=$P(APCLCUML(600),U,3)+1
G75 ;
 S:'$D(APCLCUML(610)) APCLCUML(610)="75gm 2 hour glucose obtained ever"
 S $P(APCLCUML(610),U,2)=$P(APCLCUML(610),U,2)+1
 S V=$$G75^APCLD518(APCLPD,$P(^DPT(APCLPD,0),U,3),APCLADAT,"I")
 I V="" S $P(APCLCUML(610),U,7)=$P(APCLCUML(610),U,7)+1 G END
 S V=$P(V,U)
 I $E(V)'=+$E(V) S $P(APCLCUML(610),U,8)=$P(APCLCUML(610),U,8)+1 G END ;unable to determine result, not a number
 S $P(APCLCUML(610),U,3)=$P(APCLCUML(610),U,3)+1
END Q
CESS(P,B,D) ;EP - find any cessation hf in 12 months before E
 I '$G(P) Q ""
 NEW APCL,E,X,G,T
 K APCL
 S X=P_"^LAST HEALTH [DM AUDIT CESSATION HLTH FACTOR;DURING "_B_"-"_D S E=$$START1^APCLDF(X,"APCL(")
 I $D(APCL(1)) Q "Yes-"_$$FMTE^XLFDT($P(APCL(1),U))
 S X=P_"^EDUC [DM AUDIT SMOKING CESS EDUC;DURING "_B_"-"_D S E=$$START1^APCLDF(X,"APCL(")
 I $D(APCL(1)) Q "Yes-"_$$FMTE^XLFDT($P(APCL(1),U))
 NEW T S T=$O(^ATXAX("B","DM AUDIT SMOKING CESS EDUC",0))
 I 'T Q "No"
 S (X,G)=0 F  S X=$O(^ATXAX(T,21,X)) Q:X'=+X!(G)  I $$REFUSAL^APCLP517(P,9999999.09,$P(^ATXAX(T,21,X,0),U),B,D) S G=1
 I G Q "Refused"
 Q "No"
 ;
