BMCFDRP ; IHS/OIT/FCJ - DRIVER TO PRINT PHY CONSULT LETTER ;        [ 09/27/2006  2:44 PM ]
 ;;4.0;REFERRED CARE INFO SYSTEM;;JAN 09, 2006
 ;IHS/ITSC/FCJ ADD LINE TO TEST FOR CLOSING SLAVE DEVICE
START ;
 W:$D(IOF) @IOF
 W "**********  REFERRAL PHYSICIAN CONSULT LETTER  **********",!!
 W "This report will produce a hard copy computer generated Consult letter.",!
GETREF ;get referral entry
 D GETTYPE
 W !! S BMCREF=""
 S DIC="^BMCREF(",DIC(0)="AEMQ",DIC("A")="Select Referral by Patient Name, date of referral or referral #: "
 S DIC("S")="I $$FILTER^BMCFLTR(3,0,2)"
 D ^DIC K DA,DIC
 G:Y=-1 XIT
 S BMCREF=+Y
 I $D(^BMCTFORM(BMCFTYPE,11)) X ^BMCTFORM(BMCFTYPE,11) G:BMCQUIT GETREF
 ;
ZIS ;
 W !! S XBRC="COMP^BMCFDRP",XBRP="PRINT^BMCFDRP",XBNS="BMC",XBRX="XIT^BMCFDRP"
 D ^XBDBQUE
 Q
 ;
GETTYPE ;
 S BMCQUIT=0
 S BMCFTYPE=""
 S BMCFTYPE=$O(^BMCTFORM("B","STANDARD CONSULT LETTER",BMCFTYPE))
 Q
PRINT ;EP
 N BMCFTYPE
 D GETTYPE
 X:$D(^BMCTFORM(BMCFTYPE,12)) ^BMCTFORM(BMCFTYPE,12)
 N BMCFTYPE
XIT ;
 K BMCCAP,BMCCHSR,BMCDA,BMCFILE,BMCFTYPE,BMCIOM,BMCKPDA,BMCNODE,BMCPG,BMCQUIT,BMCR0,BMCREF,BMCRNS,BMCV,BMCWP,BMCX,BMCY,BMCI,BMCDFN,BMCCHSAS
 K A,C,D,D0,D1,DA,DD,DDSFILE,DI,DIADD,DIC,DICR,DIE,DIK,DINUM,DIPGM,DIQ,DIR,DIW,DIWI,DIWT,DIWTC,DIWX,DIWF,DIWL,DIWR,DLAYGO,DO,DQ,DR,DTOUT
 K F,G,I,J,N,P,T,X,Y,Z
 K BMCPROUT,BMCN,BMCNI,BMCNUM,BMCVIEN
 K BMCCHSCT,BMCCMT,BMCRDATE,BMCREC,BMCRIEN,BMCRIO,BMCRNUMB,BMCRSTAT,BMCRTYPE,BMCVST,BMCVSTP
 I $D(IO("S")) S IOP="`"_IOS D ^%ZIS
 Q
COMP ;
 Q
