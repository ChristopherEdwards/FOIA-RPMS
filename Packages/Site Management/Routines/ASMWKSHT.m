ASMWKSHT ;PRINT A WORK-SHEET FOR FACILITY MODIFICATIONS [ 09/20/85  3:34 PM ]
 ;IHS-OKLA CITY AREA OFFICE-LMD
A1 D ^AUCLS W "FACILITY MODIFICATION WORKSHEET.......",!!! S DIC="^ASMMOD(",DIC(0)="QAZEM" D ^DIC Q:Y<1  S AU("MODPTR")=+Y,AU("MOD")=Y(0) G QUE
START U IO S PG=0,SITE="",AU("LINE")="=",AU("ULINE")="___________" D HEADING
L1 S SITE=$O(^ASMEQP("B",SITE)) G END:SITE="" S SITEDFN=$O(^ASMEQP("B",SITE,0)) G L1:'$D(^ASMEQP(SITEDFN,7)) S DAA=0
L2 K AU("MODFOUND") S DIC=1800002.07,DA=SITEDFN,DR=.01 F AU=1:1 S DAA=$O(^ASMEQP(DA,7,DAA)) Q:DAA=""  S LKDATA=$P(^ASMEQP(DA,7,DAA,0),"^",1)  I LKDATA=AU("MODPTR") S AU("MODFOUND")="" Q
L3 G L1:'$D(AU("MODFOUND")) W ?5,$P(^AUTTLOC(SITE,0),U,1),?50 S DRENT=DAA,DR=1 D ^AUDICLK W $S(LKPRINT="":AU("ULINE"),1:LKPRINT),! D HEADING:$Y>50 G L1
END K AU W @IOF C IO Q
SBRS K DFOUT,DTOUT,DUOUT,DQOUT,DLOUT R Y:USTO I '$T W *7 R Y:5 G SBRS:Y="." I '$T S (DTOUT,Y)="" Q
 S:Y="/.," (DFOUT,Y)="" S:Y="" DLOUT="" S:Y="^" (DUOUT,Y)="" S:Y?1"?".E!(Y["^") (DQOUT,Y)=""
 Q
YN W !!,"Enter a ""Y"" for YES or an ""N"" for NO." H 2 Q
LINE S:'$D(AU("PRL")) AU("OLD")="" S:AU("OLD")'=AU("LINE") AU("PRL")="",$P(AU("PRL"),AU("LINE"),79)="",AU("OLD")=AU("LINE") W !,AU("PRL"),! Q
HEADING S PG=PG+1,TITLE="FACILITY MODIFICATION WORKSHEET",TM=$P($H,",",2),HR=TM\3600,MIN=TM#3600\60 S:MIN<10 MIN="0"_MIN S TME=HR_":"_MIN,USER=""
 W #,!!,TME,?80-$L(TITLE)\2,TITLE,?72,"page ",PG,!,?80-$L(^DD("SITE"))\2,^DD("SITE"),!
UCI X ^%ZOSF("UCI") S MG("UCI")="UCI: "_$P(Y,",",1) W ?80-$L(MG("UCI"))\2,MG("UCI")
 I '$D(DT) S %DT="",X="T" D ^%DT S DT=Y
 S Y=DT X ^DD("DD") W !!,?80-$L("as of "_Y)\2,"as of ",Y,!!
 W !!,?5,"MODIFICATION:  ",AU("MOD"),!!,?10,"FACILITY",?50,"DATE COMPLETED" D LINE
 W ! Q
PRQ S AU("MODPTR")=^%ZTSK(ZTSK,"MODPTR"),AU("MOD")=^%ZTSK(ZTSK,"MOD")
PRQ1 S:$D(^%ZTSK(ZTSK,"SITE")) SITENUM=^%ZTSK(ZTSK,"SITE") S U="^" K ^%ZTSK(ZTSK) G START
QUE S IOP="Q" D ^%AUQUE G START:$D(AU("PRINT")) Q:'$D(AU("QUE"))
QUE1 S ^%ZTSK(ZTSK,0)="PRQ^ASMWKSHT"_^%ZTSK(ZTSK,0),^("MODPTR")=AU("MODPTR"),^("MOD")=AU("MOD")
QUEND K ZTSK Q
