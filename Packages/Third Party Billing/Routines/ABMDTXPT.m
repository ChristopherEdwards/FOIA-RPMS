ABMDTXPT ; IHS/ASDST/DMJ - REPRINT TRANSMITTAL LIST ;
 ;;2.6;IHS 3P BILLING SYSTEM;;NOV 12, 2009
START ;START HERE
 S DIC="^ABMDAOTX(DUZ(2),",DIC(0)="AEMQ" D ^DIC Q:Y<0  S ABM("Y")=+Y
 S %ZIS="NQ" D ^%ZIS
 I IO'=IO(0) D QUE,HOME^%ZIS K ABM Q
 I $D(IO("S")) S IOP=ION D ^%ZIS
L1 ;TASKMAN COMES HERE - FIRST LOOP
 S DA=0 F  S DA=$O(^ABMDBILL(DUZ(2),"AZ",ABM("Y"),DA)) Q:'DA  D
 F I=1:1:8 S ABM(I)=$P(^ABMDBILL(DUZ(2),DA,0),"^",I)
 S ABM(9)=$S($P($G(^AUTNINS(ABM(8),2)),U)="R":1,$P($G(^(2)),U)="D":2,1:3)
 S ^TMP("ABMDTX",$J,ABM(9),ABM(5),DA)=""
L2 ;SECOND LOOP
 S I=0 F  S I=$O(^TMP("ABMDTX",$J,I)) Q:'I  D
 .S J=0 F  S J=$O(^TMP("ABMDTX",$J,I,J)) Q:'J  D
 ..S DA=0 F  S DA=$O(^TMP("ABMDTX",$J,I,J,DA)) Q:'DA  D
 ...F K=1:1:8 S ABM(K)=$P(^ABMDBILL(DUZ(2),DA,0),"^",I)
 ...W !
 Q
QUE ;QUE TO TASKMAN
 S ZTRTN="L1^ABMDTXPT",ZTDESC="TRANSMITTAL LIST REPRINT"
 S ZTSAVE("ABM(""Y"")")=""
 K ZTSK D ^%ZTLOAD W:$G(ZTSK) !,"Task # ",ZTSK," queued.",!
 Q
