ABMUTLP2 ; IHS/ASDST/DMJ - PAYER UTILITIES ;      
 ;;2.6;IHS 3P BILLING SYSTEM;**10,11**;NOV 12, 2009;Build 133
 ;abm*2.6*10 - split from ABMUTLP
SOP ;EP - source of pay (claim filing indicator)
 S ABMTYP=$P($G(^AUTNINS(+ABMP("INS",ABMI),2)),U,11)
 I ABMTYP D  Q
 .S ABMP("SOP",ABMI)=$P(^AUTTCFI(ABMTYP,0),U)
 S ABMTYP=$P(ABMP("INS",ABMI),"^",2)
 ;S Y=$F("HMDRPWCFNIK",ABMTYP)  ;abm*2.6*8 5010
 ;S Y=$F("HMDRPWCFIK",ABMTYP)  ;abm*2.6*8 5010  ;abm*2.6*10 HEAT69121
 ;S ABMP("SOP",ABMI)=$P("^HM^SP^MC^MA^CI^WC^CH^ZZ^09^OF^MC","^",Y)  ;abm*2.6*8 5010
 ;S ABMP("SOP",ABMI)=$P("^HM^SP^MC^MA^CI^WC^CH^ZZ^OF^MC","^",Y)  ;abm*2.6*8 5010  ;abm*2.6*10 HEAT69121
 ;start new code abm*2.6*10 HEAT69121
 I ABMTYP="H" S ABMP("SOP",ABMI)="HM"
 I ABMTYP="M" S ABMP("SOP",ABMI)="SP"
 I ABMTYP="D" S ABMP("SOP",ABMI)="MC"
 I ABMTYP="R" S ABMP("SOP",ABMI)="MA"
 I ABMTYP="P" S ABMP("SOP",ABMI)="CI"
 I ABMTYP="W" S ABMP("SOP",ABMI)="WC"
 I ABMTYP="C" S ABMP("SOP",ABMI)="CH"
 I ABMTYP="F" S ABMP("SOP",ABMI)="ZZ"
 I ABMTYP="I"!(ABMTYP="MD") S ABMP("SOP",ABMI)="OF"
 I ABMTYP="K" S ABMP("SOP",ABMI)="MC"
 I ABMTYP="MH" S ABMP("SOP",ABMI)="16"
 ;end new code HEAT69121
 I $$BCBS1^ABMERUTL(+ABMP("INS",ABMI)) D
 .S ABMP("SOP",ABMI)="BL"
 ;I ABMP("SOP",ABMI)="MA",(ABMP("VTYP")=999!($P($G(^ABMDPARM(DUZ(2),1,5)),U,3)="C00900"))!((ABMP("BTYP")=831)&(ABMP("EXP")=22)) D  ;abm*2.6*11 HEAT96809
 I $G(ABMP("SOP",ABMI))="MA",(ABMP("VTYP")=999!($P($G(^ABMDPARM(DUZ(2),1,5)),U,3)="C00900"))!((ABMP("BTYP")=831)&(ABMP("EXP")=22)) D  ;abm*2.6*11 HEAT96809
 .S ABMP("SOP",ABMI)="MB"
 ;I ABMP("SOP",ABMI)="MA",(ABMP("VTYP")=999!($P($G(^ABMDPARM(DUZ(2),1,5)),U,3)="04402"))!((ABMP("BTYP")=831)&(ABMP("EXP")=22)) D  ;abm*2.6*10 NOHEAT
 ;I ABMP("SOP",ABMI)="MA",(ABMP("VTYP")=999!($P($G(^ABMDPARM(DUZ(2),1,5)),U,3)="04402"))!((ABMP("BTYP")=831)&((ABMP("EXP")=22)!(ABMP("EXP")=32))) D  ;abm*2.6*10 NOHEAT  ;abm*2.6*10 HEAT68447
 ;I ABMP("SOP",ABMI)="MA",(ABMP("VTYP")=999!($P($G(^ABMDPARM(ABMP("LDFN"),1,5)),U,3)="04402"))!((ABMP("BTYP")=831)&((ABMP("EXP")=22)!(ABMP("EXP")=32))) D  ;abm*2.6*10 NOHEAT  ;abm*2.6*10 HEAT68447  ;abm*2.6*10 HEAT74059
 ;I ABMP("SOP",ABMI)="MA",(ABMP("VTYP")=999!(("^04312^04212^04112^04412^04402^")[("^"_$P($G(^ABMDPARM(ABMP("LDFN"),1,5)),U,3)_"^")))!((ABMP("BTYP")=831)&((ABMP("EXP")=22)!(ABMP("EXP")=32))) D  ;abm*2.6*10 NOHEAT HEAT68447 HEAT74059  ;abm*2.6*11 HEAT96809
 I $G(ABMP("SOP",ABMI))="MA",(ABMP("VTYP")=999!(("^04312^04212^04112^04412^04402^")[("^"_$P($G(^ABMDPARM(ABMP("LDFN"),1,5)),U,3)_"^")))!((ABMP("BTYP")=831)&((ABMP("EXP")=22)!(ABMP("EXP")=32))) D  ;abm*2.6*11 HEAT96809
 .S ABMP("SOP",ABMI)="MB"
 Q
OVER ;EP - get override values from 3P Ins file
 ;S ABMOEXP=$S(ABMP("EXP")=21:11,ABMP("EXP")=22:14,ABMP("EXP")=23:18,1:0)  ;abm*2.6*10 HEAT65683
 S ABMOEXP=$S(ABMP("EXP")=21!(ABMP("EXP")=31):11,ABMP("EXP")=22!(ABMP("EXP")=32):14,ABMP("EXP")=23!(ABMP("EXP")=33):18,1:0)  ;abm*2.6*10 HEAT65683
 Q:ABMOEXP=0
 S ABMOPC=0
 ;F  S ABMOPC=$O(^ABMNINS(DUZ(2),ABMP("INS"),2,"AOVR",ABMOEXP,ABMOLN,ABMOPC)) Q:'ABMOPC  D  ;abm*2.6*10 HEAT53137
 F  S ABMOPC=$O(^ABMNINS(ABMP("LDFN"),ABMP("INS"),2,"AOVR",ABMOEXP,ABMOLN,ABMOPC)) Q:'ABMOPC  D  ;abm*2.6*10 HEAT53137
 .K ABMOVTYP
 .;start old code abm*2.6*10 HEAT53137
 .;I $D(^ABMNINS(DUZ(2),ABMP("INS"),2,"AOVR",ABMOEXP,ABMOLN,ABMOPC,0)) S ABMOVTYP=0
 .;I $D(^ABMNINS(DUZ(2),ABMP("INS"),2,"AOVR",ABMOEXP,ABMOLN,ABMOPC,ABMP("VTYP"))) S ABMOVTYP=ABMP("VTYP")
 .;end old code start new code HEAT53137
 .I $D(^ABMNINS(ABMP("LDFN"),ABMP("INS"),2,"AOVR",ABMOEXP,ABMOLN,ABMOPC,0)) S ABMOVTYP=0
 .I $D(^ABMNINS(ABMP("LDFN"),ABMP("INS"),2,"AOVR",ABMOEXP,ABMOLN,ABMOPC,ABMP("VTYP"))) S ABMOVTYP=ABMP("VTYP")
 .;end new code HEAT53137
 .Q:'$D(ABMOVTYP)
 .S ABMVALUE=^ABMNINS(DUZ(2),ABMP("INS"),2,"AOVR",ABMOEXP,ABMOLN,ABMOPC,ABMOVTYP)
 .;
 .I ABMOLN=51 S ABMOLN=40,ABMPC=4 D  Q
 ..S $P(ABMR("NM1",ABMOLN),"^",ABMPC)=ABMVALUE
 ..S $P(ABMREC("NM1"),"*",ABMPC)=ABMVALUE
 .;
 .I ABMOLN=52 S ABMOLN=20,ABMPC=2 D  Q
 ..S $P(ABMR("N3",ABMOLN),"^",ABMPC)=ABMVALUE
 ..S $P(ABMREC("N3"),"*",ABMPC)=ABMVALUE
 .;
 .I ABMOLN=53 D  Q
 ..S ABMR("N4",20)=$P(ABMVALUE,",")  ;city
 ..S $P(ABMREC("N4"),"*",2)=ABMR("N4",20)
 ..S ABMR("N4",30)=$P($P(ABMVALUE,", ",2),"  ")  ;state
 ..S $P(ABMREC("N4"),"*",3)=ABMR("N4",30)
 ..S ABMR("N4",40)=$P($P(ABMVALUE,",",2),"  ",2)  ;zip
 ..S $P(ABMREC("N4"),"*",4)=ABMR("N4",40)
 ;
 K ABMOLN,ABMOPC,ABMVALUE,ABMOVTYP
 Q
