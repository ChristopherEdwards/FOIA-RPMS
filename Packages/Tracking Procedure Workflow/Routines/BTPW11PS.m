BTPW11PS ;VNGT/HS/ALA-Installation for CMET Version 1.1 ; 24 Apr 2008  7:46 PM
 ;;1.1;CARE MANAGEMENT EVENT TRACKING;;Apr 01, 2015;Build 25
 ;
PRE ;EP
 NEW DA,DIK
 S DIK="^BTPW(90621,",DA=0
 F  S DA=$O(^BTPW(90621,DA)) Q:'DA  D ^DIK
 Q
 ;
POST ;EP
 D ^BTPWA
 D ^BTPWC
 ;Repoint taxonomies in 90621
 NEW EVT,TXN,TYP,ATXN,GLOB
 S EVT=0
 F  S EVT=$O(^BTPW(90621,EVT)) Q:'EVT  D
 . S TXN=0
 . F  S TXN=$O(^BTPW(90621,EVT,1,TXN)) Q:'TXN  D
 .. S TAX=$P(^BTPW(90621,EVT,1,TXN,0),U,1),TYP=$P(^(0),U,3)
 .. I TYP'=3 D
 ... S ATXN=$O(^ATXAX("B",TAX,""))
 ... S $P(^BTPW(90621,EVT,1,TXN,0),U,2)=ATXN_";ATXAX("
 .. I TYP=3 D
 ... S ATXN=$O(^ATXLAB("B",TAX,"")),GLOB=";ATXLAB("
 ... I ATXN="" S ATXN=$O(^ATXAX("B",TAX,"")),GLOB=";ATXAX(" I ATXN="" S GLOB=""
 ... S $P(^BTPW(90621,EVT,1,TXN,0),U,2)=ATXN_GLOB
 Q
