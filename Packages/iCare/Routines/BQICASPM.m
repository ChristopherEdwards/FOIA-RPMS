BQICASPM ;GDHS/HCD/ALA-Comm Alert Site Params ; 15 Feb 2016  12:30 PM
 ;;2.5;ICARE MANAGEMENT SYSTEM;;May 24, 2016;Build 27
 ;
 ;
GET(DATA,FAKE) ;EP -- BQI GET COMM ALERTS POPUP
 NEW UID,II,EM
 S UID=$S($G(ZTSK):"Z"_ZTSK,1:$J)
 S DATA=$NA(^TMP(UID,"BQICASPM"))
 K @DATA
 S II=0
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BQICASPM D UNWIND^%ZTER" ; SAC 2006 2.2.3.3.2
 ;
 S HDR="T00003DISPLAY_POPUP"
 S @DATA@(II)=HDR_$C(30)
 S II=II+1,@DATA@(II)=$$GET1^DIQ(90508,"1,",16,"E")_$C(30)
 ;
DONE ;
 S II=II+1,@DATA@(II)=$C(31)
 Q
 ;
ERR ;
 D ^%ZTER
 NEW Y,ERRDTM
 S Y=$$NOW^XLFDT() X ^DD("DD") S ERRDTM=Y
 S BMXSEC="Recording that an error occurred at "_ERRDTM
 I $D(II),$D(DATA) S II=II+1,@DATA@(II)=$C(31)
 Q
 Q
 ;
SAV(DATA,PARM) ;EP -- BQI SET COMM ALERTS POPUP
 NEW RESULT,ERROR,RESULT,BQIUPD,MSG,DA
 S UID=$S($G(ZTSK):"Z"_ZTSK,1:$J)
 S DATA=$NA(^TMP(UID,"BQIUCAPM",UID))
 K @DATA
 ;
 S II=0
 NEW $ESTACK,$ETRAP S $ETRAP="D ERR^BQICASPM D UNWIND^%ZTER" ; SAC 2006 2.2.3.3.2
 S @DATA@(II)="I00010RESULT^T01024ERROR"_$C(30)
 ;
 S RESULT=1,PARM=$G(PARM,""),MSG=""
 S DA=$$SPM^BQIGPUTL()
 I PARM'="" S BQIUPD(90508,DA_",",16)=PARM
 I $D(BQIUPD) D FILE^DIE("E","BQIUPD","ERROR")
 I $D(ERROR) S RESULT=-1,MSG=$G(ERROR("DIERR",1,"TEXT",1))
 ;
 S II=II+1,@DATA@(II)=RESULT_U_MSG_$C(30)
 S II=II+1,@DATA@(II)=$C(31)
 Q
