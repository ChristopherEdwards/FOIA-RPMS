BQITRASM ;GDHS/HCS/ALA-CVD Assessment ; 12 Jun 2016  2:39 PM
 ;;2.5;ICARE MANAGEMENT SYSTEM;**1**;May 24, 2016;Build 17
 ;
EN(TDFN,BQIHSM,ARRAY) ;EP
 NEW MX,BHSN
 S MX=$$MEAS^BQIDCUTL(TDFN,"ACC")
 I MX'=0 S ARRAY="" Q
 S ARRAY(0)=1
 S BHSN=0 F  S BHSN=$O(^APCHSURV(APCHSITI,12,BHSN)) Q:'BHSN  D
 . S ARRAY(BHSN)=^APCHSURV(APCHSITI,12,BHSN,0)
 Q
 ;
APCH ; EP - Tag to be called from Health Summary
 NEW APCHSTAT,BQITXT,APCHSCT,APCHSGHR,APCHSL,LSN
 Q:'$$INAC^APCHSMU(APCHSITI)
 S APCHLAST="",APCHNEXT="" K APCHSTEX
 I $G(APCHCOLW)="" S APCHCOLW=10
 S BQITXT=$P(^APCHSURV(APCHSITI,0),U,1)
 D EN(APCHSPAT,BQITXT,.APCHSTEX)
 M ARRAY=APCHSTEX
 K ^UTILITY($J,"W")
 NEW DIWL,DIWR,BQI,X
 S DIWR=40,DIWL=1
 F BQI=1:1 Q:'$D(APCHSTEX(BQI))  D
 . S X=APCHSTEX(BQI)
 . D ^DIWP
 K APCHSTEX
 S X=0 F  S X=$O(^UTILITY($J,"W",DIWL,X)) Q:X'=+X  S APCHSTEX(X)=^UTILITY($J,"W",DIWL,X,0)
 M ARRAY=APCHSTEX
 D WRITETP^BQITRPHS
 K ^UTILITY($J,"W")
 ;S LSN=$O(ARRAY(""),-1),ARRAY(LSN)=ARRAY(LSN)_$C(30)
 Q
